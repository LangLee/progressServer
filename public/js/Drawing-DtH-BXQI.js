import{N as g,n as f,l as v,m as b,o as x,u as _,D,b as V,j as N}from"./tiptap-DvRu_p-f.js";import{bb as k,bc as C,bd as E,be as S,ax as y,ay as i,aM as B,aN as F,aC as d,aI as p,aJ as c,az as l,aB as m,aQ as M,aU as z,ad as A,aL as h,aA as J,ao as w}from"./vendor-BLq22pPX.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as T}from"./utils-_yvyshlj.js";const P=t=>t[Math.floor(Math.random()*t.length)],L={name:"PaperView",components:{NodeViewWrapper:g},props:f,data(){return{color:P(["#A975FF","#FB5151","#FD9170","#FFCB6B","#68CEF8","#80CBC4","#9DEF8F"]),size:Math.ceil(Math.random()*Math.floor(10)),svg:null,path:null,points:[],drawing:!1,id:new Date().getTime()}},methods:{onStartDrawing(t){this.drawing=!0,this.points=[],this.path=this.svg.append("path").data([this.points]).attr("id",`id-${this.id}`).attr("stroke",this.color).attr("stroke-width",this.size);const s=t.type==="mousedown"?"mousemove":"touchmove";this.svg.on(s,this.onMove)},onMove(t){t.preventDefault(),this.points.push(k(t)[0]),this.tick()},onEndDrawing(){this.svg.on("mousemove",null),this.svg.on("touchmove",null),this.drawing&&(this.drawing=!1,this.svg.select(`#id-${this.id}`).remove(),this.id=new Date().getTime())},tick(){requestAnimationFrame(()=>{this.path.attr("d",t=>{const s=C().curve(E)(t),n=this.node.attrs.lines.filter(u=>u.id!==this.id);return this.updateAttributes({lines:[...n,{id:this.id,color:this.color,size:this.size,path:s}]}),s})})},clear(){this.updateAttributes({lines:[]})}},mounted(){this.svg=S(this.$refs.canvas),this.svg.on("mousedown",this.onStartDrawing).on("mouseup",this.onEndDrawing).on("mouseleave",this.onEndDrawing).on("touchstart",this.onStartDrawing).on("touchend",this.onEndDrawing).on("touchleave",this.onEndDrawing)}},U={class:"flex flex-row p-2"},$={class:"bg-slate-50 cursor-crosshair",viewBox:"0 0 500 250",ref:"canvas"},H=["d","id","stroke","stroke-width"];function R(t,s,n,u,a,r){const o=y("node-view-wrapper");return i(),B(o,{class:"draw"},{default:F(()=>[d("div",null,[d("div",U,[p(d("input",{class:"mr-2",type:"color","onUpdate:modelValue":s[0]||(s[0]=e=>a.color=e)},null,512),[[c,a.color]]),p(d("input",{class:"text-sm mr-2",type:"number",min:"1",max:"10","onUpdate:modelValue":s[1]||(s[1]=e=>a.size=e)},null,512),[[c,a.size]]),d("button",{class:"bg-blue-400 text-slate-50 rounded-md px-2 text-sm hover:bg-blue-700",onClick:s[2]||(s[2]=(...e)=>r.clear&&r.clear(...e))}," 清除 ")]),(i(),l("svg",$,[(i(!0),l(m,null,M(t.node.attrs.lines,e=>(i(),l(m,null,[e.id!==a.id?(i(),l("path",{class:"fill-none",key:e.id,d:e.path,id:`id-${e.id}`,stroke:e.color,"stroke-width":e.size},null,8,H)):z("",!0)],64))),256))],512))])]),_:1})}const W=O(L,[["render",R]]),j=v.create({name:"paper",group:"block",atom:!0,addAttributes(){return{lines:{default:[]}}},parseHTML(){return[{tag:'div[data-type="paper"]'}]},renderHTML({HTMLAttributes:t}){return["div",b(t,{"data-type":"paper"})]},addNodeView(){return x(W)}}),q={id:"editorWrapper",class:"min-w-0 flex-auto px-4 sm:px-6 xl:px-8 py-10"},Y=A({__name:"Drawing",props:{modelValue:String,editable:{type:Boolean,default:!0}},emits:["update:modelValue","update:anchors"],setup(t,{emit:s}){const n=t,u=s,a=T(o=>{const e=o.getJSON();u("update:modelValue",JSON.stringify(e))},300),r=_({editable:n.editable,content:JSON.parse(n.modelValue||""),editorProps:{attributes:{class:"prose w-full max-w-full focus:outline-none"}},extensions:[D.extend({content:"paper"}),V,j],onUpdate:({editor:o})=>{a(o)}});return h(()=>n.modelValue,o=>{let e=r.value;JSON.stringify(e&&e.getJSON())!==o&&e&&e.commands.setContent(JSON.parse(o||""),!0)}),h(()=>n.editable,(o,e)=>{o!==e&&r.value&&r.value.setEditable(o)}),(o,e)=>(i(),l("div",q,[J(w(N),{class:"h-full",editor:w(r)},null,8,["editor"])]))}});export{Y as default};
