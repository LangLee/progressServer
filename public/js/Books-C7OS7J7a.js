import{M as F}from"./Menu-CG1yttFe.js";import{H as N}from"./Header-BZE7___w.js";import{au as S,av as V,ae as x,aw as D,ak as z,ag as E,ar as H,aM as O,ay as d,az as h,aC as o,aA as n,aJ as j,aK as J,aR as T,aS as L,aB as k,aQ as B,aT as K,aI as M,aU as I,ad as R,aN as P,aO as U,ax as Q}from"./vendor-BNUAhoVR.js";import{R as i}from"./RemixIcon-D7fRXDKe.js";import{s as W}from"./book-CTB1ni6Z.js";import"./GroupModal-CQHL7XIo.js";import"./Modal-CRZm8Nfu.js";import"./message-IIE1a5pF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./userInfo-CWFSU6LP.js";import"./user-vqedsJWp.js";import"./index-CajyH5eH.js";const G={key:0,class:"fixed top-0 left-0 inset-0 center z-50 backdrop-blur bg-white/50"},X={class:"flex flex-col w-full lg:w-1/2 mx-auto lg:mt-[10%] max-h-full lg:max-h-[60%] shadow-lg rounded-lg bg-white"},Y={class:"flex px-6 py-4 border-b border-slate-100"},Z={class:"flex flex-1 items-center"},ee={class:"flex flex-1 flex-col p-6 overflow-auto"},oe={key:0,class:"text-center p-6"},ae=o("p",{class:"text-slate-300 text-base"},"没有搜索结果",-1),te=[ae],se={key:1,class:"text-normal font-normal text-slate-600"},le=["onClick"],ne={class:"flex-1"},re={key:0,class:"ml-4"},ce=["onClick"],de={class:"flex-1"},ue={class:"flex h-10 py-2 px-6 border-t border-slate-100 leading-6"},ie=o("span",{class:"mr-8"},"选择",-1),he=o("span",null,"上下移动",-1),pe={__name:"SearchModal",props:{visible:{type:Boolean,default:!1},container:{type:[String,Object],default:"body"}},emits:["update:visible"],setup(_,{emit:p}){const u=S();V();const c=_;let s=null;const l=x(""),r=x([]),e=x(),q=p,b=()=>{q("update:visible",!1)},A=()=>{l.value&&W(l.value).then(a=>{a&&a.length>=0&&(r.value=a,e.value={bookIdx:0,anchorIdx:-1})})},y=a=>{u.push({path:`/books/${a.id}`,query:{appId:a.appId}}),b()},$=(a,t)=>{u.push({path:`/books/${a.id}`,query:{appId:a.appId,anchorId:t.id}}),b()},C=a=>{if(a.key==="Escape")b(),a.preventDefault();else if(a.key==="ArrowUp"){if(e.value){if(e.value.anchorIdx>-1)e.value.anchorIdx--;else if(e.value.bookIdx>0){e.value.bookIdx--;let t=r.value[e.value.bookIdx];t&&t.anchors&&t.anchors.length>0&&(e.value.anchorIdx=t.anchors.length-1)}}}else if(a.key==="ArrowDown"){if(e.value){let t=r.value[e.value.bookIdx];e.value.anchorIdx<t.anchors.length-1?e.value.anchorIdx++:e.value.bookIdx<r.value.length-1&&(e.value.bookIdx++,e.value.anchorIdx=-1)}}else if(a.key==="Enter"&&e.value){let t=r.value[e.value.bookIdx];e.value.anchorIdx>-1?$(t,t.anchors[e.value.anchorIdx]):y(t)}};D(()=>{document.addEventListener("keydown",C)}),z(()=>{typeof c.container=="string"?s=document.querySelector(c.container):s=c.container,s?s.appendChild(m.$el):console.error("Invalid container specified for CustomPopup."),m.$nextTick(()=>{m.$refs.searchInput.focus()})}),E(()=>{document.removeEventListener("keydown",C),s&&s.contains(m.$el)&&(s.removeChild(m.$el),s=null)});const{proxy:m}=H();return O(()=>c.visible,(a,t)=>{a&&a!==t&&m.$nextTick(()=>{m.$refs.searchInput.focus()})},{immediate:!0}),(a,t)=>_.visible?(d(),h("div",G,[o("div",X,[o("div",Y,[o("div",Z,[n(i,{name:"search-line",class:"leading-6"}),j(o("input",{placeholder:"输入关键字",class:"flex flex-1 px-2 text-slate-600 placeholder-slate-300 text-base focus:outline-none focus:border-transparent","onUpdate:modelValue":t[0]||(t[0]=v=>l.value=v),onKeyup:T(A,["enter"]),ref:"searchInput"},null,544),[[J,l.value]])]),o("button",{class:"rounded px-2 bg-slate-100 hover:bg-blue-300 hover:text-slate-100",onClick:L(b,["stop"])},[n(i,{name:"close-line",class:"leading-6"})])]),o("div",ee,[!r.value||r.value.length<1?(d(),h("div",oe,te)):(d(),h("ul",se,[(d(!0),h(k,null,B(r.value,(v,f)=>(d(),h("li",{key:f},[o("a",{onClick:w=>y(v),class:K(["flex m-2 p-2 lg:p-4 hover:bg-blue-400 rounded-lg hover:text-slate-100 shadow-sm",{"bg-slate-100":e.value.bookIdx!==f||e.value.anchorIdx!==-1,"bg-blue-500":e.value.bookIdx===f&&e.value.anchorIdx===-1,"text-slate-100":e.value.bookIdx===f&&e.value.anchorIdx===-1}])},[o("div",ne,[n(i,{name:"book-open-line",class:"font-semibold mr-4 p-1 border-2 rounded hover:border-slate-100"}),o("span",null,M(v.title),1)]),n(i,{name:"arrow-right-s-line"})],10,le),v.anchors&&v.anchors.length>0?(d(),h("ul",re,[(d(!0),h(k,null,B(v.anchors,(w,g)=>(d(),h("li",{key:g,class:"pl-4 border-l-2 border-slate-100"},[o("a",{onClick:we=>$(v,w),class:K(["flex m-2 p-2 lg:p-4 hover:bg-blue-400 rounded-lg hover:text-slate-100 shadow-sm",{"bg-slate-100":e.value.bookIdx!==f||e.value.anchorIdx!==g,"bg-blue-500":e.value.bookIdx===f&&e.value.anchorIdx===g,"text-slate-100":e.value.bookIdx===f&&e.value.anchorIdx===g}])},[o("div",de,[n(i,{name:"hashtag",class:"font-semibold mr-4 p-1 border-2 rounded hover:border-slate-100"}),o("span",null,M(w.textContent),1)]),n(i,{name:"arrow-right-s-line"})],10,ce)]))),128))])):I("",!0)]))),128))]))]),o("div",ue,[n(i,{name:"corner-down-left-line",class:"px-2 mr-2 rounded shadow-sm shadow-slate-700"}),ie,n(i,{name:"arrow-down-line",class:"px-2 mr-2 rounded shadow-sm shadow-slate-700"}),n(i,{name:"arrow-up-line",class:"px-2 mr-2 rounded shadow-sm shadow-slate-700"}),he])])])):I("",!0)}},ve=["onKeydown"],me=o("span",{class:"px-3 text-normal"},"搜索一切",-1),fe=o("span",{class:"px-1 text-normal bg-slate-200 rounded"},"⌘K",-1),xe=o("span",null,"这是一个测试",-1),_e=R({__name:"Search",setup(_){const p=x(!1),u=()=>{p.value=!0},c=s=>{s.key==="k"&&s.metaKey&&(p.value=!0,s.preventDefault())};return D(()=>{document.addEventListener("keydown",c)}),E(()=>{document.removeEventListener("keydown",c)}),(s,l)=>(d(),h(k,null,[o("button",{class:"text-slate-400 px-2 lg:px-4 py-3 my-2",onClick:u,onKeydown:T(L(c,["meta"]),["key"])},[n(i,{name:"search-line"}),me,fe],40,ve),p.value?(d(),P(pe,{key:0,visible:p.value,"onUpdate:visible":l[0]||(l[0]=r=>p.value=r)},{default:U(()=>[xe]),_:1},8,["visible"])):I("",!0)],64))}}),be={id:"content",class:"w-full max-w-screen-2xl mx-auto"},ge={class:"lg:flex"},ke={id:"contentWrapper",class:"min-w-0 w-full flex-auto lg:static lg:max-h-full lg:overflow-visible lg:pl-80"},Re=R({__name:"Books",setup(_){const p=S(),u=x(!0),c=l=>{if(l!==void 0){u.value=l;return}u.value=!u.value},s=(l,r)=>{let e=l?`/books/${l}`:"/books";p.replace({path:e,query:{appId:r}})};return(l,r)=>{const e=Q("router-view");return d(),h(k,null,[n(N,{onToggleFold:c,fold:u.value},{default:U(()=>[n(_e)]),_:1},8,["fold"]),o("div",be,[o("div",ge,[n(F,{editable:!0,onToggleFold:c,fold:u.value,onMenuChange:s},null,8,["fold"]),o("div",ke,[n(e)])])])],64)}}});export{Re as default};
