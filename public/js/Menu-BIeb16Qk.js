import{az as ve,aA as pe,aj as m,ao as fe,aR as G,aD as l,aE as s,aH as c,aF as f,aX as u,aZ as C,aG as q,aV as z,aY as X,aw as he,aO as A,aP as j,aW as H,aN as L,aT as O,a$ as W,b0 as me,b1 as be}from"./vendor-Ca624vxD.js";import{c as xe,u as Y,r as ye}from"./book-BoQwkkU-.js";import{g as ge,B as ke,G as _e,c as Ce,u as Te,r as $e}from"./GroupModal-SqgswNQa.js";import{m as T}from"./message-BXUz8B8N.js";import{R as y}from"./RemixIcon-Cy7WqHn8.js";import{i as Z,c as Be}from"./utils-BIo_BOvM.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J=h=>(me("data-v-a95bc6f9"),h=h(),be(),h),we={key:0,class:"flex h-14 px-1 sm:px-3 xl:px-5 py-1 pt-4 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Me=J(()=>c("span",null,"分类",-1)),Ge=J(()=>c("span",null,"笔记",-1)),Ee={class:"flex-1 px-1 sm:px-3 xl:px-5 lg:text-sm pb-10 lg:pb-14 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Se=["onUpdate:modelValue","onKeyup"],Pe=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Ve={class:"text-base mr-2"},De={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Re=["onClick"],Ue=["onClick"],Fe={class:"ml-3"},Ke=["id"],Ne=["onUpdate:modelValue","onKeyup"],qe=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],ze={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Xe=["onClick"],Ae=["onClick"],je=["onClick"],He={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0}},emits:["toggleFold","menuChange"],setup(h,{emit:Q}){ve();const x=pe(),n=m([]),ee=m(x.query.appId),I=m(""),g=m(""),r=m(""),v=m(void 0),d=m(void 0),p=m(!1);let k=null;const{proxy:_}=he(),$=h,w=m(!0),E=Q,M=()=>{w.value=!0,E("toggleFold",!0)},B=e=>{let{id:t}=e||{};I.value=t||"",r.value="",M(),E("menuChange",t,x.query.appId)},te=()=>{v.value={name:"新增分类"},p.value=!0},ae=e=>{e!=="default"&&(r.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},oe=e=>{v.value=e,p.value=!1},ne=()=>{v.value&&p.value?Ce(v.value).then(e=>{let{_id:t,name:a}=e;t&&(n.value.push({id:t,name:a,books:[]}),r.value="",v.value=void 0,p.value=!1)}):v.value&&S(v.value)},S=e=>{Te(e).then(()=>{r.value="",v.value=void 0,p.value=!1})},le=(e,t)=>{if(e.books&&e.books.length>0){T.warning("该分类下有书籍，不能删除!");return}$e(e.id).then(()=>{T.success("删除分类成功!"),n.value.splice(t,1)})},se=()=>{var e;p.value=!0,d.value={title:"新增笔记",type:$.fixedType||"markdown",category:(e=n==null?void 0:n.value[0])==null?void 0:e.id}},ie=()=>{d&&p.value?xe(d.value).then(e=>{let t=n.value.find(({id:a})=>a===e.category);!t&&(t=n.value.find(({id:a})=>a==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),B(e),d.value=void 0)}):d&&d.value&&V(d.value)},P=()=>{r.value="",d.value=void 0,v.value=void 0,p.value=!1},ue=(e,t)=>{let a=e[t];!a||!a.id||ye(a.id).then(()=>{e.splice(t,1);let b=e&&e.length>t?t:e.length-1;B(b<0?null:e[b]),T.success("删除书籍成功!")})},re=e=>{r.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;t&&t[0]&&t[0].focus()})},de=e=>{r.value=e.category,d.value=e,p.value=!1},V=e=>{Y({...e,category:e.category==="default"?"":e.category}).then(t=>{r.value,e.category,r.value="",d.value=void 0})};fe(()=>{ge($.defaultGroup).then(e=>{n.value=e||[],$.defaultSelected&&!x.params.id&&n.value[0]&&n.value[0].books&&n.value[0].books[0]&&B(n.value[0].books[0]),x.params.id&&_.$nextTick(()=>{D(x.params.id||n.value[0].books[0].id)})})});const D=e=>{let t=document.getElementById("sideBar");if(t&&e){let a=document.getElementById(`book-${e}`);a&&t.scrollTo({top:a.offsetTop,behavior:"smooth"})}},R=e=>{if(Z())return!1;g.value=e},U=e=>{if(Z())return!1;g.value=""},F=(e,t)=>{k={x:e.touches[0].clientX,target:t}},K=(e,t)=>{if(!k)return!0;let{x:a,target:b}=k;if(b!==t)return k=null,!0;let o=e.changedTouches[0].clientX;if(Math.abs(a-o)<10)return k=null,!0;a>o?g.value=t:a<o&&(g.value=""),k=null},ce=e=>{e.share=!e.share,Y(e).then(t=>{if(e.share){const a=`${window.location.origin}/#/book/${e.id}`,b=`标题：${e.title}
链接：${a}
`;Be(b),T.success("已经复制到剪切板！")}else T.success("取消分享成功！")})};return G(()=>x.params.id,(e,t)=>{e!==t&&(I.value=e,r.value="",M(),_.$nextTick(()=>{D(e)}))},{immediate:!0}),G(()=>x.query.appId,e=>{ee.value=e,console.log(e)},{immediate:!0}),G(()=>$.fold,(e,t)=>{w.value=e},{immediate:!0}),(e,t)=>(l(),s("div",{id:"sideBar",class:X(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-50 bg-black/20 dark:bg-transparent lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",w.value?"translate-x-[-100%]":"translate-x-0"]),onClick:u(M,["stop"])},[h.editable?(l(),s("div",we,[c("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:u(te,["stop"])},[f(y,{name:"add-line"}),Me]),c("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:u(se,["stop"])},[f(y,{name:"add-line"}),Ge])])):C("",!0),c("nav",Ee,[c("ul",null,[(l(!0),s(q,null,z(n.value,(a,b)=>(l(),s("li",{key:a.id},[a.id===r.value?A((l(),s("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":o=>a.name=o,onKeyup:H(o=>S(a),["enter"])},null,40,Se)),[[j,a.name]]):(l(),s("div",{key:1,class:"px-3 py-2 leading-none relative font-medium text-gray-900 dark:text-gray-50 cursor-pointer",onDblclick:u(o=>ae(a.id),["stop"]),onMouseover:u(o=>R(a.id),["stop"]),onMouseleave:u(o=>U(a.id),["stop"]),onTouchstartPassive:o=>F(o,a.id),onTouchendPassive:o=>K(o,a.id)},[c("span",Ve,L(a.name),1),f(W,{name:"slide"},{default:O(()=>[g.value===a.id?(l(),s("div",De,[h.editable&&!a.readonly?(l(),s("span",{key:0,class:"cursor-pointer bg-blue-300 hover:bg-blue-700 p-2",onClick:u(o=>oe(a),["stop"])},[f(y,{name:"edit-line"})],8,Re)):C("",!0),h.editable&&!a.readonly&&(!a.books||a.books.length<=0)?(l(),s("span",{key:1,class:"cursor-pointer bg-red-300 hover:bg-red-700 p-2",onClick:u(o=>le(a,b),["stop"])},[f(y,{name:"delete-bin-line"})],8,Ue)):C("",!0)])):C("",!0)]),_:2},1024)],40,Pe)),c("ul",Fe,[(l(!0),s(q,null,z(a.books,(o,N)=>(l(),s("li",{id:`book-${o.id}`,key:o.id},[o.id===r.value?A((l(),s("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":i=>o.title=i,onKeyup:H(i=>V(o),["enter"])},null,40,Ne)),[[j,o.title]]):(l(),s("a",{key:1,onClick:u(i=>B(o),["stop"]),onDblclick:u(i=>re(o.id),["stop"]),onMouseover:i=>R(o.id),onMouseleave:i=>U(o.id),onTouchstartPassive:i=>F(i,o.id),onTouchendPassive:i=>K(i,o.id),class:"px-3 py-2 leading-none transition-colors duration-200 relative block font-normal text-gray-500 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-50 cursor-pointer"},[c("span",{class:X(["relative inline-block text-base text-ellipsis whitespace-nowrap overflow-hidden",o.id===I.value?"text-blue-500 font-bold":""])},L(o.title),3),f(W,{name:"slide"},{default:O(()=>[h.editable&&g.value===o.id?(l(),s("div",ze,[c("span",{class:"cursor-pointer bg-slate-300 hover:bg-slate-500 p-2",onClick:u(i=>ce(o),["stop"])},[f(y,{name:o.share?"eye-off-line":"share-line"},null,8,["name"])],8,Xe),c("span",{class:"cursor-pointer bg-blue-300 hover:bg-blue-500 p-2",onClick:u(i=>de(o),["stop"])},[f(y,{name:"edit-line"})],8,Ae),c("span",{class:"cursor-pointer bg-red-300 hover:bg-red-500 p-2",onClick:u(i=>ue(a.books,N),["stop"])},[f(y,{name:"delete-bin-line"})],8,je)])):C("",!0)]),_:2},1024)],40,qe))],8,Ke))),128))])]))),128))])]),f(ke,{fixedType:h.fixedType,title:`${p.value?"新增":"编辑"}书籍`,visible:!!d.value,onConfirm:ie,onCancel:P,book:d.value,categories:n.value},null,8,["fixedType","title","visible","book","categories"]),f(_e,{title:`${p.value?"新增分类":"编辑分类"}`,visible:!!v.value,group:v.value,onConfirm:ne,onCancel:P},null,8,["title","visible","group"])],2))}},et=Ie(He,[["__scopeId","data-v-a95bc6f9"]]);export{et as M};
