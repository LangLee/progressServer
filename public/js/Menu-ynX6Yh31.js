import{aK as pe,aL as me,aj as h,ak as he,ap as be,aW as M,az as n,aA as o,aD as d,aG as i,aF as u,aH as _,aO as q,b2 as z,aZ as ye,aB as O,aX as X,b3 as j,b4 as A,aE as L,a$ as W,ba as H,bb as ge,bc as ke}from"./vendor-DqHIQWU1.js";import{c as xe,u as Z,r as _e}from"./book-J-0CnIOg.js";import{g as Be,B as Ce,G as Te,c as $e,u as we,r as Ie}from"./GroupModal-DcQdgpqj.js";import{_ as Me,m as T}from"./message-DsTL7g5X.js";import{_ as b,m as J,b as Ge}from"./index-bEem1MK9.js";import{i as Q,c as Ee}from"./utils-DVDKZiQc.js";const Y=f=>(ge("data-v-ff4b55fd"),f=f(),ke(),f),Se={key:0,class:"flex lg:mx-4 py-2 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60 font-sans-serif font-medium"},Ve=Y(()=>d("span",null,"分类",-1)),Pe=Y(()=>d("span",null,"笔记",-1)),De={key:1,id:"navBar",class:"relative flex-1 px-1 sm:px-3 xl:px-5 pb-4 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60 overflow-y-auto"},Ue=["onUpdate:modelValue","onKeyup"],Ke=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Fe={class:"mr-2"},Ne={key:0,class:"absolute right-2 top-0 font-sans text-slate-50"},Re=["onClick"],qe=["onClick"],ze={class:"ml-2 px-1 border-l border-gray-200 dark:border-gray-500"},Oe=["id"],Xe=["onUpdate:modelValue","onKeyup"],je=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Ae={class:"break-all"},Le={key:0,class:"absolute right-2 top-1 font-sans text-slate-50"},We=["onClick"],He=["onClick"],Ze=["onClick"],Je={key:2,class:"h-full flex flex-col justify-center text-center text-gray-500 text-sm bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Qe={class:"mt-1 italic"},Ye={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0},share:{type:Boolean,default:!1}},emits:["toggleFold","menuChange"],setup(f,{emit:ee}){pe();const g=me(),s=h([]),te=h(g.query.appId),w=h(""),k=h(""),c=h(""),p=h(void 0),v=h(void 0),m=h(!1);let x=null;const{proxy:B}=he(),C=f,I=h(!0),G=ee,ae=e=>{switch(e){case"markdown":return"markdown-line";case"text":return"draft-line";case"chat":return"message-2-line";case"link":return"links-line";case"todo":return"todo-line";case"drawing":return"image-edit-line";case"code":return"file-code-line";default:return"markdown-line"}},E=()=>{I.value=!0,G("toggleFold",!0)},$=e=>{let{id:t}=e||{};E(),G("menuChange",t,g.query.appId)},S=()=>{p.value={name:"新增分类"},m.value=!0},le=e=>{e!=="default"&&(c.value=e,B.$nextTick(()=>{let t=B.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},ne=e=>{p.value=e,m.value=!1},oe=()=>{p.value&&m.value?$e(p.value).then(e=>{let{_id:t,name:a}=e;t&&(s.value.push({id:t,name:a,books:[]}),c.value="",p.value=void 0,m.value=!1)}):p.value&&V(p.value)},V=e=>{we(e).then(()=>{c.value="",p.value=void 0,m.value=!1})},se=(e,t)=>{if(e.books&&e.books.length>0){T.warning("该分类下有书籍，不能删除!");return}J.confirm({title:"确认删除",content:"确定删除该分类？",onOk:()=>{Ie(e.id).then(()=>{T.success("删除分类成功!"),s.value.splice(t,1)})}})},re=()=>{var e;m.value=!0,v.value={title:"新增笔记",type:C.fixedType||"markdown",category:(e=s==null?void 0:s.value[0])==null?void 0:e.id}},ie=()=>{v&&m.value?xe(v.value).then(e=>{let t=s.value.find(({id:a})=>a===e.category);!t&&(t=s.value.find(({id:a})=>a==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),$(e),v.value=void 0)}):v&&v.value&&D(v.value)},P=()=>{c.value="",v.value=void 0,p.value=void 0,m.value=!1},ue=(e,t)=>{let a=e[t];!a||!a.id||J.confirm({title:"确认删除",content:"确认删除该内容？",onOk:()=>{_e(a.id).then(()=>{e.splice(t,1);let y=e&&e.length>t?t:e.length-1;$(y<0?null:e[y]),T.success("删除书籍成功!")})}})},de=e=>{c.value=e,B.$nextTick(()=>{let t=B.$refs.titleInput;t&&t[0]&&t[0].focus()})},ce=e=>{c.value=e.category,v.value=e,m.value=!1},D=e=>{Z({...e,category:e.category==="default"?"":e.category}).then(t=>{c.value,e.category,c.value="",v.value=void 0})};be(()=>{Be(C.defaultGroup,C.share).then(e=>{var t,a;s.value=e||[],g.params.id?(w.value=g.params.id,c.value="",B.$nextTick(()=>{ve(g.params.id)})):C.defaultSelected&&((a=(t=s.value[0])==null?void 0:t.books)!=null&&a[0])&&$(s.value[0].books[0])})});const ve=e=>{if(document.getElementById("navBar"),navBar&&e){let t=document.getElementById(`book-${e}`);t&&navBar.scrollTo({top:t.offsetTop,behavior:"smooth"})}},U=e=>{if(Q())return!1;k.value=e},K=e=>{if(Q())return!1;k.value=""},F=(e,t)=>{x={x:e.touches[0].clientX,target:t}},N=(e,t)=>{if(!x)return!0;let{x:a,target:y}=x;if(y!==t)return x=null,!0;let l=e.changedTouches[0].clientX;if(Math.abs(a-l)<10)return x=null,!0;a>l?k.value=t:a<l&&(k.value=""),x=null},fe=e=>{e.share=!e.share,Z(e).then(t=>{if(e.share){const a=`${Ge}/#/book/${e.id}`,y=`标题：${e.title}
链接：${a}
`;Ee(y),T.success("已经复制到剪切板！")}else T.success("取消分享成功！")})};return M(()=>g.params.id,(e,t)=>{e!==t&&(w.value=e,c.value="")},{immediate:!0}),M(()=>g.query.appId,e=>{te.value=e,console.log(e)},{immediate:!0}),M(()=>C.fold,(e,t)=>{I.value=e},{immediate:!0}),(e,t)=>(n(),o("div",{id:"sideBar",class:O(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-50 bg-black/20 dark:bg-transparent lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",I.value?"translate-x-[-100%]":"translate-x-0"]),onClick:u(E,["stop"])},[f.editable&&s.value&&s.value.length>0?(n(),o("div",Se,[d("button",{class:"h-8 leading-8 text-blue-500 hover:text-blue-700 dark:text-blue-300 dark:hover:text-blue-500 mx-2",onClick:u(S,["stop"])},[i(b,{class:"mr-1",name:"folder-add-line"}),Ve]),d("button",{class:"h-8 leading-8 text-blue-500 hover:text-blue-700 dark:text-blue-300 dark:hover:text-blue-500 mx-2",onClick:u(re,["stop"])},[i(b,{class:"mr-1",name:"sticky-note-add-line"}),Pe])])):_("",!0),s.value&&s.value.length>0?(n(),o("nav",De,[d("ul",null,[(n(!0),o(q,null,z(s.value,(a,y)=>(n(),o("li",{key:a.id},[a.id===c.value?X((n(),o("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":l=>a.name=l,onKeyup:A(l=>V(a),["enter"])},null,40,Ue)),[[j,a.name]]):(n(),o("div",{key:1,class:"px-1 h-10 leading-10 relative font-medium text-gray-700 dark:text-gray-300 cursor-pointer",onDblclick:u(l=>le(a.id),["stop"]),onMouseover:u(l=>U(a.id),["stop"]),onMouseleave:u(l=>K(a.id),["stop"]),onTouchstartPassive:l=>F(l,a.id),onTouchendPassive:l=>N(l,a.id)},[d("span",Fe,L(a.name),1),i(H,{name:"slide"},{default:W(()=>[k.value===a.id?(n(),o("div",Ne,[f.editable&&!a.readonly?(n(),o("span",{key:0,class:"rounded cursor-pointer bg-blue-300 hover:bg-blue-700 mr-1",onClick:u(l=>ne(a),["stop"])},[i(b,{name:"edit-line"})],8,Re)):_("",!0),f.editable&&!a.readonly&&(!a.books||a.books.length<=0)?(n(),o("span",{key:1,class:"rounded cursor-pointer bg-red-300 hover:bg-red-700",onClick:u(l=>se(a,y),["stop"])},[i(b,{name:"delete-bin-line"})],8,qe)):_("",!0)])):_("",!0)]),_:2},1024)],40,Ke)),d("ul",ze,[(n(!0),o(q,null,z(a.books,(l,R)=>(n(),o("li",{class:"mb-1",id:`book-${l.id}`,key:l.id},[l.id===c.value?X((n(),o("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":r=>l.title=r,onKeyup:A(r=>D(l),["enter"])},null,40,Xe)),[[j,l.title]]):(n(),o("a",{key:1,onClick:u(r=>$(l),["stop"]),onDblclick:u(r=>de(l.id),["stop"]),onMouseover:r=>U(l.id),onMouseleave:r=>K(l.id),onTouchstartPassive:r=>F(r,l.id),onTouchendPassive:r=>N(r,l.id),class:"p-1 block rounded-md transition-colors duration-200 relative text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"},[d("span",{class:O(["w-full h-full flex flex-row",l.id===w.value?"text-blue-500 dark:text-blue-300":""])},[i(b,{class:"text-blue-300 mr-1",name:ae(l.type)},null,8,["name"]),d("span",Ae,L(l.title),1)],2),i(H,{name:"slide"},{default:W(()=>[f.editable&&k.value===l.id?(n(),o("div",Le,[d("span",{class:"rounded cursor-pointer bg-slate-300 hover:bg-slate-500 mr-1",onClick:u(r=>fe(l),["stop"])},[i(b,{name:l.share?"eye-off-line":"share-line"},null,8,["name"])],8,We),d("span",{class:"rounded cursor-pointer bg-blue-300 hover:bg-blue-500 mr-1",onClick:u(r=>ce(l),["stop"])},[i(b,{name:"edit-line"})],8,He),d("span",{class:"rounded cursor-pointer bg-red-300 hover:bg-red-500",onClick:u(r=>ue(a.books,R),["stop"])},[i(b,{name:"delete-bin-line"})],8,Ze)])):_("",!0)]),_:2},1024)],40,je))],8,Oe))),128))])]))),128))])])):(n(),o("div",Je,[i(b,{name:"folder-6-line",class:"text-2xl"}),d("p",Qe,[ye("暂无数据"),f.editable?(n(),o("a",{key:0,src:"#",class:"text-blue-300 mt-2 underline cursor-pointer hover:text-blue-500",onClick:S},"创建")):_("",!0)])])),i(Ce,{fixedType:f.fixedType,title:`${m.value?"新增":"编辑"}书籍`,visible:!!v.value,onConfirm:ie,onCancel:P,book:v.value,categories:s.value},null,8,["fixedType","title","visible","book","categories"]),i(Te,{title:`${m.value?"新增分类":"编辑分类"}`,visible:!!p.value,group:p.value,onConfirm:oe,onCancel:P},null,8,["title","visible","group"])],2))}},st=Me(Ye,[["__scopeId","data-v-ff4b55fd"]]);export{st as M};
