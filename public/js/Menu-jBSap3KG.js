import{az as pe,aA as me,aj as h,ao as he,aR as G,aD as o,aE as s,aH as d,aF as r,aV as u,aX as T,aG as z,aT as X,a$ as j,aW as A,aw as ge,aO as H,aP as L,aU as O,aN as W,aS as J,b0 as Q,b1 as ye,b2 as xe}from"./vendor-7SOp03Eo.js";import{c as be,u as Y,r as ke}from"./book-D8GVYk51.js";import{g as _e,B as Te,G as Ce,c as $e,u as Be,r as we}from"./GroupModal-CTqx1GXs.js";import{m as C}from"./message-DneuB5hD.js";import{R as g}from"./RemixIcon-C3kAUqBT.js";import{i as Z,c as Ie}from"./utils-BIo_BOvM.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee=m=>(ye("data-v-399102c7"),m=m(),xe(),m),Ge={key:0,class:"flex lg:mx-4 py-2 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60 font-sans-serif font-medium"},Ee=ee(()=>d("span",null,"分类",-1)),Se=ee(()=>d("span",null,"笔记",-1)),Ve={key:1,class:"flex-1 px-1 sm:px-3 xl:px-5 pb-10 lg:pb-14 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Pe=["onUpdate:modelValue","onKeyup"],De=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Re={class:"mr-2"},Ue={key:0,class:"absolute right-2 top-0 font-sans text-slate-50"},Ne=["onClick"],Fe=["onClick"],Ke={class:"ml-2 px-2 border-l border-gray-200 dark:border-gray-500"},qe=["id"],ze=["onUpdate:modelValue","onKeyup"],Xe=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],je={key:0,class:"absolute right-2 top-0 font-sans text-slate-50"},Ae=["onClick"],He=["onClick"],Le=["onClick"],Oe={key:2,class:"h-1/2 flex flex-col justify-center text-center text-gray-500 text-sm"},We={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0}},emits:["toggleFold","menuChange"],setup(m,{emit:te}){pe();const x=me(),l=h([]),ae=h(x.query.appId),w=h(""),b=h(""),c=h(""),f=h(void 0),v=h(void 0),p=h(!1);let k=null;const{proxy:_}=ge(),$=m,I=h(!0),E=te,ne=e=>{switch(e){case"markdown":return"markdown-line";case"text":return"draft-line";case"chat":return"message-2-line";case"link":return"links-line";case"todo":return"todo-line";case"drawing":return"image-edit-line";case"code":return"file-code-line";default:return"markdown-line"}},M=()=>{I.value=!0,E("toggleFold",!0)},B=e=>{let{id:t}=e||{};w.value=t||"",c.value="",M(),E("menuChange",t,x.query.appId)},S=()=>{f.value={name:"新增分类"},p.value=!0},le=e=>{e!=="default"&&(c.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},oe=e=>{f.value=e,p.value=!1},se=()=>{f.value&&p.value?$e(f.value).then(e=>{let{_id:t,name:a}=e;t&&(l.value.push({id:t,name:a,books:[]}),c.value="",f.value=void 0,p.value=!1)}):f.value&&V(f.value)},V=e=>{Be(e).then(()=>{c.value="",f.value=void 0,p.value=!1})},ie=(e,t)=>{if(e.books&&e.books.length>0){C.warning("该分类下有书籍，不能删除!");return}we(e.id).then(()=>{C.success("删除分类成功!"),l.value.splice(t,1)})},re=()=>{var e;p.value=!0,v.value={title:"新增笔记",type:$.fixedType||"markdown",category:(e=l==null?void 0:l.value[0])==null?void 0:e.id}},ue=()=>{v&&p.value?be(v.value).then(e=>{let t=l.value.find(({id:a})=>a===e.category);!t&&(t=l.value.find(({id:a})=>a==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),B(e),v.value=void 0)}):v&&v.value&&D(v.value)},P=()=>{c.value="",v.value=void 0,f.value=void 0,p.value=!1},de=(e,t)=>{let a=e[t];!a||!a.id||ke(a.id).then(()=>{e.splice(t,1);let y=e&&e.length>t?t:e.length-1;B(y<0?null:e[y]),C.success("删除书籍成功!")})},ce=e=>{c.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;t&&t[0]&&t[0].focus()})},ve=e=>{c.value=e.category,v.value=e,p.value=!1},D=e=>{Y({...e,category:e.category==="default"?"":e.category}).then(t=>{c.value,e.category,c.value="",v.value=void 0})};he(()=>{_e($.defaultGroup).then(e=>{l.value=e||[],$.defaultSelected&&!x.params.id&&l.value[0]&&l.value[0].books&&l.value[0].books[0]&&B(l.value[0].books[0]),x.params.id&&_.$nextTick(()=>{R(x.params.id||l.value[0].books[0].id)})})});const R=e=>{let t=document.getElementById("sideBar");if(t&&e){let a=document.getElementById(`book-${e}`);a&&t.scrollTo({top:a.offsetTop,behavior:"smooth"})}},U=e=>{if(Z())return!1;b.value=e},N=e=>{if(Z())return!1;b.value=""},F=(e,t)=>{k={x:e.touches[0].clientX,target:t}},K=(e,t)=>{if(!k)return!0;let{x:a,target:y}=k;if(y!==t)return k=null,!0;let n=e.changedTouches[0].clientX;if(Math.abs(a-n)<10)return k=null,!0;a>n?b.value=t:a<n&&(b.value=""),k=null},fe=e=>{e.share=!e.share,Y(e).then(t=>{if(e.share){const a=`${window.location.origin}/#/book/${e.id}`,y=`标题：${e.title}
链接：${a}
`;Ie(y),C.success("已经复制到剪切板！")}else C.success("取消分享成功！")})};return G(()=>x.params.id,(e,t)=>{e!==t&&(w.value=e,c.value="",M(),_.$nextTick(()=>{R(e)}))},{immediate:!0}),G(()=>x.query.appId,e=>{ae.value=e,console.log(e)},{immediate:!0}),G(()=>$.fold,(e,t)=>{I.value=e},{immediate:!0}),(e,t)=>(o(),s("div",{id:"sideBar",class:A(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-50 bg-black/20 dark:bg-transparent lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",I.value?"translate-x-[-100%]":"translate-x-0"]),onClick:u(M,["stop"])},[m.editable?(o(),s("div",Ge,[d("button",{class:"h-8 leading-8 text-blue-500 hover:text-blue-700 mx-2",onClick:u(S,["stop"])},[r(g,{class:"mr-1",name:"folder-add-line"}),Ee]),d("button",{class:"h-8 leading-8 text-blue-500 hover:text-blue-700 mx-2",onClick:u(re,["stop"])},[r(g,{class:"mr-1",name:"sticky-note-add-line"}),Se])])):T("",!0),l.value&&l.value.length>0?(o(),s("nav",Ve,[d("ul",null,[(o(!0),s(z,null,X(l.value,(a,y)=>(o(),s("li",{key:a.id},[a.id===c.value?H((o(),s("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":n=>a.name=n,onKeyup:O(n=>V(a),["enter"])},null,40,Pe)),[[L,a.name]]):(o(),s("div",{key:1,class:"px-1 h-10 leading-10 relative font-medium text-gray-700 dark:text-gray-300 cursor-pointer",onDblclick:u(n=>le(a.id),["stop"]),onMouseover:u(n=>U(a.id),["stop"]),onMouseleave:u(n=>N(a.id),["stop"]),onTouchstartPassive:n=>F(n,a.id),onTouchendPassive:n=>K(n,a.id)},[d("span",Re,W(a.name),1),r(Q,{name:"slide"},{default:J(()=>[b.value===a.id?(o(),s("div",Ue,[m.editable&&!a.readonly?(o(),s("span",{key:0,class:"rounded cursor-pointer bg-blue-300 hover:bg-blue-700 mr-1",onClick:u(n=>oe(a),["stop"])},[r(g,{name:"edit-line"})],8,Ne)):T("",!0),m.editable&&!a.readonly&&(!a.books||a.books.length<=0)?(o(),s("span",{key:1,class:"rounded cursor-pointer bg-red-300 hover:bg-red-700",onClick:u(n=>ie(a,y),["stop"])},[r(g,{name:"delete-bin-line"})],8,Fe)):T("",!0)])):T("",!0)]),_:2},1024)],40,De)),d("ul",Ke,[(o(!0),s(z,null,X(a.books,(n,q)=>(o(),s("li",{class:"mb-1",id:`book-${n.id}`,key:n.id},[n.id===c.value?H((o(),s("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":i=>n.title=i,onKeyup:O(i=>D(n),["enter"])},null,40,ze)),[[L,n.title]]):(o(),s("a",{key:1,onClick:u(i=>B(n),["stop"]),onDblclick:u(i=>ce(n.id),["stop"]),onMouseover:i=>U(n.id),onMouseleave:i=>N(n.id),onTouchstartPassive:i=>F(i,n.id),onTouchendPassive:i=>K(i,n.id),class:"h-8 leading-8 block px-2 rounded-md transition-colors duration-200 relative text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"},[d("span",{class:A(["relative inline-block text-ellipsis whitespace-nowrap overflow-hidden",n.id===w.value?"text-blue-500 font-bold":""])},[r(g,{class:"text-blue-500",name:ne(n.type)},null,8,["name"]),j(" "+W(n.title),1)],2),r(Q,{name:"slide"},{default:J(()=>[m.editable&&b.value===n.id?(o(),s("div",je,[d("span",{class:"rounded cursor-pointer bg-slate-300 hover:bg-slate-500 mr-1",onClick:u(i=>fe(n),["stop"])},[r(g,{name:n.share?"eye-off-line":"share-line"},null,8,["name"])],8,Ae),d("span",{class:"rounded cursor-pointer bg-blue-300 hover:bg-blue-500 mr-1",onClick:u(i=>ve(n),["stop"])},[r(g,{name:"edit-line"})],8,He),d("span",{class:"rounded cursor-pointer bg-red-300 hover:bg-red-500",onClick:u(i=>de(a.books,q),["stop"])},[r(g,{name:"delete-bin-line"})],8,Le)])):T("",!0)]),_:2},1024)],40,Xe))],8,qe))),128))])]))),128))])])):(o(),s("div",Oe,[r(g,{name:"folder-6-line",class:"text-2xl"}),d("p",{class:"mt-1 italic"},[j("暂无数据"),d("a",{src:"#",class:"text-blue-500 mt-2 underline cursor-pointer hover:text-blue-700",onClick:S},"创建")])])),r(Te,{fixedType:m.fixedType,title:`${p.value?"新增":"编辑"}书籍`,visible:!!v.value,onConfirm:ue,onCancel:P,book:v.value,categories:l.value},null,8,["fixedType","title","visible","book","categories"]),r(Ce,{title:`${p.value?"新增分类":"编辑分类"}`,visible:!!f.value,group:f.value,onConfirm:se,onCancel:P},null,8,["title","visible","group"])],2))}},nt=Me(We,[["__scopeId","data-v-399102c7"]]);export{nt as M};
