import{au as de,av as ce,ae as b,ak as ve,aM as S,ax as pe,ay as s,az as i,aC as l,aA as f,aS as h,aU as T,aB as A,aQ as J,aT as L,ar as fe,aJ as O,aK as Q,aR as W,aI as P,aO as M,aW as Y,aX as me,aY as he}from"./vendor-BNUAhoVR.js";import{c as be,u as xe,r as ye}from"./book-CTB1ni6Z.js";import{g as _e,B as ge,G as ke,c as Ce,u as Be,r as Te}from"./GroupModal-CQHL7XIo.js";import{m as V}from"./message-IIE1a5pF.js";import{R as k}from"./RemixIcon-D7fRXDKe.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const C=m=>(me("data-v-01fb76c2"),m=m(),he(),m),$e={key:0,class:"flex h-14 px-1 sm:px-3 xl:px-5 py-1 pt-4 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Me=C(()=>l("span",null,"分类",-1)),we=C(()=>l("span",null,"笔记",-1)),Ge={class:"flex-1 px-1 sm:px-3 xl:px-5 lg:text-sm pb-10 lg:pb-14 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Ee=["onUpdate:modelValue","onKeyup"],Se=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Pe={class:"text-base mr-2"},Ve={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Re=["onClick"],Ue=C(()=>l("span",null,"编辑",-1)),De=["onClick"],Ke=C(()=>l("span",null,"删除",-1)),Fe={class:"ml-3"},Ne=["id"],qe=["onUpdate:modelValue","onKeyup"],ze=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Xe={class:"p-2 bg-slate-700 text-white text-sm rounded shadow-md"},Ae={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Je=["onClick"],Le=C(()=>l("span",null,"编辑",-1)),Oe=["onClick"],Qe=C(()=>l("span",null,"删除",-1)),We={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0}},emits:["toggleFold","menuChange"],setup(m,{emit:j}){de();const x=ce(),u=b([]),H=b(x.query.appId),w=b(""),y=b(""),r=b(""),v=b(void 0),d=b(void 0),p=b(!1);let _=null;const{proxy:g}=fe(),I=m,G=b(!0),R=j,E=()=>{G.value=!0,R("toggleFold",!0)},$=e=>{let{id:t}=e||{};w.value=t||"",r.value="",E(),R("menuChange",t,x.query.appId)},Z=()=>{v.value={name:"新增分类"},p.value=!0},ee=e=>{e!=="default"&&(r.value=e,g.$nextTick(()=>{let t=g.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},te=e=>{v.value=e,p.value=!1},ae=()=>{v.value&&p.value?Ce(v.value).then(e=>{let{_id:t,name:n}=e;t&&(u.value.push({id:t,name:n,books:[]}),r.value="",v.value=void 0,p.value=!1)}):v.value&&U(v.value)},U=e=>{Be(e).then(()=>{r.value="",v.value=void 0,p.value=!1})},oe=(e,t)=>{if(e.books&&e.books.length>0){V.warning("该分类下有书籍，不能删除!");return}Te(e.id).then(()=>{V.success("删除分类成功!"),u.value.splice(t,1)})},ne=()=>{p.value=!0,d.value={title:"新增笔记",type:I.fixedType||"markdown"}},le=()=>{d&&p.value?be(d.value).then(e=>{let t=u.value.find(({id:n})=>n===e.category);!t&&(t=u.value.find(({id:n})=>n==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),$(e),d.value=void 0)}):d&&d.value&&K(d.value)},D=()=>{r.value="",d.value=void 0,v.value=void 0,p.value=!1},se=(e,t)=>{let n=e[t];!n||!n.id||ye(n.id).then(()=>{e.splice(t,1);let o=e&&e.length>t?t:e.length-1;$(o<0?null:e[o]),V.success("删除书籍成功!")})},ie=e=>{r.value=e,g.$nextTick(()=>{let t=g.$refs.titleInput;t&&t[0]&&t[0].focus()})},ue=e=>{r.value=e.category,d.value=e,p.value=!1},K=e=>{xe({...e,category:e.category==="default"?"":e.category}).then(t=>{r.value,e.category,r.value="",d.value=void 0})};ve(()=>{_e(I.defaultGroup).then(e=>{u.value=e||[],I.defaultSelected&&!x.params.id&&u.value[0]&&u.value[0].books&&u.value[0].books[0]&&$(u.value[0].books[0]),x.params.id&&g.$nextTick(()=>{F(x.params.id||u.value[0].books[0].id)})})});const F=e=>{let t=document.getElementById("sideBar");if(t&&e){let n=document.getElementById(`book-${e}`);n&&t.scrollTo({top:n.offsetTop,behavior:"smooth"})}},N=e=>{y.value=e},q=e=>{y.value=""},z=(e,t)=>{_={x:e.touches[0].clientX,target:t}},X=(e,t)=>{if(!_)return;let{x:n,target:o}=_;if(o!==t){_=null;return}let B=e.changedTouches[0].clientX;if(Math.abs(n-B)<10){_=null;return}n>B?y.value=t:n<B&&(y.value=""),_=null};return S(()=>x.params.id,(e,t)=>{e!==t&&(w.value=e,r.value="",E(),g.$nextTick(()=>{F(e)}))},{immediate:!0}),S(()=>x.query.appId,e=>{H.value=e,console.log(e)},{immediate:!0}),S(()=>I.fold,(e,t)=>{G.value=e},{immediate:!0}),(e,t)=>{const n=pe("tippy");return s(),i("div",{id:"sideBar",class:L(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-20 bg-black/20 dark:bg-transparent lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",G.value?"translate-x-[-100%]":"translate-x-0"]),onClick:h(E,["stop"])},[m.editable?(s(),i("div",$e,[l("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:h(Z,["stop"])},[f(k,{name:"add-line"}),Me]),l("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:h(ne,["stop"])},[f(k,{name:"add-line"}),we])])):T("",!0),l("nav",Ge,[l("ul",null,[(s(!0),i(A,null,J(u.value,(o,B)=>(s(),i("li",{key:o.id},[o.id===r.value?O((s(),i("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":a=>o.name=a,onKeyup:W(a=>U(o),["enter"])},null,40,Ee)),[[Q,o.name]]):(s(),i("div",{key:1,class:"px-3 py-2 relative font-medium text-gray-900 dark:text-gray-50 cursor-pointer",onDblclick:h(a=>ee(o.id),["stop"]),onMouseover:a=>N(o.id),onMouseleave:a=>q(o.id),onTouchstartPassive:a=>z(a,o.id),onTouchendPassive:a=>X(a,o.id)},[l("span",Pe,P(o.name),1),f(Y,{name:"fade"},{default:M(()=>[y.value===o.id?(s(),i("div",Ve,[m.editable&&!o.readonly?(s(),i("span",{key:0,class:"cursor-pointer bg-blue-300 hover:bg-blue-700 p-2",onClick:h(a=>te(o),["stop"])},[f(k,{name:"edit-line"}),Ue],8,Re)):T("",!0),m.editable&&!o.readonly&&(!o.books||o.books.length<=0)?(s(),i("span",{key:1,class:"cursor-pointer bg-red-300 hover:bg-red-700 p-2",onClick:h(a=>oe(o,B),["stop"])},[f(k,{name:"delete-bin-line"}),Ke],8,De)):T("",!0)])):T("",!0)]),_:2},1024)],40,Se)),l("ul",Fe,[(s(!0),i(A,null,J(o.books,(a,re)=>(s(),i("li",{id:`book-${a.id}`,key:a.id},[a.id===r.value?O((s(),i("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":c=>a.title=c,onKeyup:W(c=>K(a),["enter"])},null,40,qe)),[[Q,a.title]]):(s(),i("a",{key:1,onClick:h(c=>$(a),["stop"]),onDblclick:h(c=>ie(a.id),["stop"]),onMouseover:c=>N(a.id),onMouseleave:c=>q(a.id),onTouchstartPassive:c=>z(c,a.id),onTouchendPassive:c=>X(c,a.id),class:"px-3 py-2 transition-colors duration-200 relative block text-grey-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-50 cursor-pointer"},[f(n,{placement:"top-start",trigger:"hover"},{content:M(()=>[l("span",Xe,P(a.title),1)]),default:M(()=>[l("span",{class:L(["relative inline-block text-base text-ellipsis whitespace-nowrap overflow-hidden",a.id===w.value?"text-blue-500 font-bold":""])},P(a.title),3)]),_:2},1024),f(Y,{name:"fade"},{default:M(()=>[m.editable&&a.id===y.value?(s(),i("div",Ae,[l("span",{class:"cursor-pointer bg-blue-300 hover:bg-blue-700 p-2",onClick:h(c=>ue(a),["stop"])},[f(k,{name:"edit-line"}),Le],8,Je),l("span",{class:"cursor-pointer bg-red-300 hover:bg-red-700 p-2",onClick:h(c=>se(o.books,re),["stop"])},[f(k,{name:"delete-bin-line"}),Qe],8,Oe)])):T("",!0)]),_:2},1024)],40,ze))],8,Ne))),128))])]))),128))])]),f(ge,{fixedType:m.fixedType,title:`${p.value?"新增":"编辑"}书籍`,visible:!!d.value,onConfirm:le,onCancel:D,book:d.value,categories:u.value},null,8,["fixedType","title","visible","book","categories"]),f(ke,{title:`${p.value?"新增分类":"编辑分类"}`,visible:!!v.value,group:v.value,onConfirm:ae,onCancel:D},null,8,["title","visible","group"])],2)}}},at=Ie(We,[["__scopeId","data-v-01fb76c2"]]);export{at as M};
