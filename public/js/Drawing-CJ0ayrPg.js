import{N as b,n as x,h as _,m as D,i as V,u as k,D as N,F,A as E}from"./tiptap-Bkjnv3GL.js";import{bn as S,bo as C,bp as y,bq as M,aN as B,az as i,a_ as z,a$ as A,aD as u,aX as c,b3 as m,aA as d,aO as h,b2 as O,aH as w,ai as J,aW as v,aG as g,au as p}from"./vendor-DqHIQWU1.js";import{_ as T}from"./message-DsTL7g5X.js";import{d as $}from"./utils-DVDKZiQc.js";import{F as P}from"./FloatMenu-C_FOx9on.js";import"./remixicon-l0sNRNKZ.js";import"./index-bEem1MK9.js";const H=t=>t[Math.floor(Math.random()*t.length)],L={name:"PaperView",components:{NodeViewWrapper:b},props:x,data(){return{color:H(["#A975FF","#FB5151","#FD9170","#FFCB6B","#68CEF8","#80CBC4","#9DEF8F"]),size:Math.ceil(Math.random()*Math.floor(10)),svg:null,path:null,points:[],drawing:!1,id:new Date().getTime()}},methods:{onStartDrawing(t){this.drawing=!0,this.points=[],this.path=this.svg.append("path").data([this.points]).attr("id",`id-${this.id}`).attr("stroke",this.color).attr("stroke-width",this.size);const s=t.type==="mousedown"?"mousemove":"touchmove";this.svg.on(s,this.onMove)},onMove(t){t.preventDefault(),this.points.push(S(t)[0]),this.tick()},onEndDrawing(){this.svg.on("mousemove",null),this.svg.on("touchmove",null),this.drawing&&(this.drawing=!1,this.svg.select(`#id-${this.id}`).remove(),this.id=new Date().getTime())},tick(){requestAnimationFrame(()=>{this.path.attr("d",t=>{const s=C().curve(y)(t),a=this.node.attrs.lines.filter(l=>l.id!==this.id);return this.updateAttributes({lines:[...a,{id:this.id,color:this.color,size:this.size,path:s}]}),s})})},clear(){this.updateAttributes({lines:[]})}},mounted(){this.svg=M(this.$refs.canvas),this.svg.on("mousedown",this.onStartDrawing).on("mouseup",this.onEndDrawing).on("mouseleave",this.onEndDrawing).on("touchstart",this.onStartDrawing).on("touchend",this.onEndDrawing).on("touchleave",this.onEndDrawing)}},U={class:"flex flex-row p-2"},W={class:"bg-slate-50 cursor-crosshair",viewBox:"0 0 500 250",ref:"canvas"},q=["d","id","stroke","stroke-width"];function R(t,s,a,l,r,n){const o=B("node-view-wrapper");return i(),z(o,{class:"draw"},{default:A(()=>[u("div",null,[u("div",U,[c(u("input",{class:"mr-2",type:"color","onUpdate:modelValue":s[0]||(s[0]=e=>r.color=e)},null,512),[[m,r.color]]),c(u("input",{class:"text-sm mr-2",type:"number",min:"1",max:"10","onUpdate:modelValue":s[1]||(s[1]=e=>r.size=e)},null,512),[[m,r.size]]),u("button",{class:"bg-blue-400 text-slate-50 rounded-md px-2 text-sm hover:bg-blue-700",onClick:s[2]||(s[2]=(...e)=>n.clear&&n.clear(...e))}," 清除 ")]),(i(),d("svg",W,[(i(!0),d(h,null,O(t.node.attrs.lines,e=>(i(),d(h,null,[e.id!==r.id?(i(),d("path",{class:"fill-none",key:e.id,d:e.path,id:`id-${e.id}`,stroke:e.color,"stroke-width":e.size},null,8,q)):w("",!0)],64))),256))],512))])]),_:1})}const G=T(L,[["render",R]]),X=_.create({name:"paper",group:"block",atom:!0,addAttributes(){return{lines:{default:[]}}},parseHTML(){return[{tag:'div[data-type="paper"]'}]},renderHTML({HTMLAttributes:t}){return["div",D(t,{"data-type":"paper"})]},addNodeView(){return V(G)}}),j={id:"editorWrapper",class:"min-w-0 flex-auto px-4 sm:px-6 xl:px-8 py-10"},I={key:0,class:"fixed top-28 right-4 z-40"},oe=J({__name:"Drawing",props:{modelValue:String,editable:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:s}){const a=t,l=s,r=$(o=>{const e=o.getJSON();l("update:modelValue",JSON.stringify(e))},300),n=k({editable:a.editable,content:JSON.parse(a.modelValue||""),editorProps:{attributes:{class:"prose w-full max-w-full focus:outline-none"}},extensions:[N.extend({content:"paper"}),F,X],onUpdate:({editor:o})=>{r(o)}});return v(()=>a.modelValue,o=>{let e=n.value;JSON.stringify(e&&e.getJSON())!==o&&e&&e.commands.setContent(JSON.parse(o||""),!0)}),v(()=>a.editable,(o,e)=>{o!==e&&n.value&&n.value.setEditable(o)}),(o,e)=>(i(),d("div",j,[g(p(E),{class:"h-full",editor:p(n)},null,8,["editor"]),t.editable?(i(),d("div",I,[g(P,{editor:p(n),onSave:e[0]||(e[0]=f=>l("save"))},null,8,["editor"])])):w("",!0)]))}});export{oe as default};
