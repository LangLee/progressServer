import{M as N}from"./Menu-ynX6Yh31.js";import{H as U}from"./Header-jlxeZXVD.js";import{aK as S,aL as V,aj as g,aM as L,ap as z,am as F,ak as H,aW as O,az as r,aA as i,aD as a,aG as n,aX as R,b3 as W,b4 as T,aF as w,aO as y,b2 as M,aB as D,aE as E,aH as $,ai as j,a_ as G,a$ as q,aN as P}from"./vendor-DqHIQWU1.js";import{_ as c}from"./index-bEem1MK9.js";import{s as X}from"./book-J-0CnIOg.js";import"./GroupModal-DcQdgpqj.js";import"./utils-DVDKZiQc.js";import"./remixicon-l0sNRNKZ.js";import"./ProInput-DLzwbHQE.js";/* empty css                                                                 */import"./message-DsTL7g5X.js";import"./userInfo-CSbayTML.js";import"./file-D7E9LNHg.js";import"./user-BZG51SbY.js";const J={class:"flex px-6 py-4 border-b border-slate-100 dark:border-slate-300/10"},Q={class:"flex flex-1 items-center"},Y={class:"flex flex-1 flex-col p-6 overflow-auto"},Z={key:0,class:"text-center p-6"},ee=a("p",{class:"text-slate-300 text-base"},"没有搜索结果",-1),ae=[ee],oe={key:1,class:"text-normal font-normal text-slate-600 dark:text-slate-300"},te=["onClick"],le={class:"flex-1"},se={key:0,class:"ml-4"},ne=["onClick"],re={class:"flex-1"},de={class:"flex h-10 py-2 px-6 border-t border-slate-100 dark:border-slate-300/10 leading-6"},ue=a("span",{class:"mr-8"},"选择",-1),ce=a("span",null,"上下移动",-1),ie={__name:"SearchModal",props:{visible:{type:Boolean,default:!1},container:{type:[String,Object],default:"body"}},emits:["update:visible"],setup(m,{emit:h}){const d=S();V();const u=m;let s=null;const p=g(""),l=g([]),e=g(),v=h,k=()=>{v("update:visible",!1)},A=()=>{p.value&&X(p.value).then(o=>{o&&o.length>=0&&(l.value=o,e.value={bookIdx:0,anchorIdx:-1})})},C=o=>{d.push({path:`/books/${o.id}`,query:{appId:o.appId}}),k()},B=(o,t)=>{d.push({path:`/books/${o.id}`,query:{appId:o.appId,anchorId:t.id}}),k()},K=o=>{if(o.key==="Escape")k(),o.preventDefault();else if(o.key==="ArrowUp"){if(e.value){if(e.value.anchorIdx>-1)e.value.anchorIdx--;else if(e.value.bookIdx>0){e.value.bookIdx--;let t=l.value[e.value.bookIdx];t&&t.anchors&&t.anchors.length>0&&(e.value.anchorIdx=t.anchors.length-1)}}}else if(o.key==="ArrowDown"){if(e.value){let t=l.value[e.value.bookIdx];e.value.anchorIdx<t.anchors.length-1?e.value.anchorIdx++:e.value.bookIdx<l.value.length-1&&(e.value.bookIdx++,e.value.anchorIdx=-1)}}else if(o.key==="Enter"&&e.value){let t=l.value[e.value.bookIdx];e.value.anchorIdx>-1?B(t,t.anchors[e.value.anchorIdx]):C(t)}};L(()=>{document.addEventListener("keydown",K)}),z(()=>{typeof u.container=="string"?s=document.querySelector(u.container):s=u.container,s?s.appendChild(x.$el):console.error("Invalid container specified for CustomPopup."),x.$nextTick(()=>{x.$refs.searchInput.focus()})}),F(()=>{document.removeEventListener("keydown",K),s&&s.contains(x.$el)&&(s.removeChild(x.$el),s=null)});const{proxy:x}=H();return O(()=>u.visible,(o,t)=>{o&&o!==t&&x.$nextTick(()=>{x.$refs.searchInput.focus()})},{immediate:!0}),(o,t)=>m.visible?(r(),i("div",{key:0,class:"flex flex-col lg:justify-start justify-end fixed top-0 left-0 inset-0 center z-50 backdrop-blur bg-black/20 dark:bg-transparent",onClick:w(k,["stop"])},[a("div",{class:"flex flex-col w-full lg:w-1/2 mx-auto lg:mt-[10%] max-h-full lg:max-h-[60%] shadow-lg rounded-lg bg-white dark:bg-neutral-800",onClick:t[1]||(t[1]=w(()=>{},["stop"]))},[a("div",J,[a("div",Q,[n(c,{name:"search-line",class:"leading-6"}),R(a("input",{placeholder:"输入关键字",class:"flex flex-1 px-2 text-slate-600 dark:text-slate-300 dark:bg-transparent placeholder-slate-300 text-base focus:outline-none focus:border-transparent","onUpdate:modelValue":t[0]||(t[0]=f=>p.value=f),onKeyup:T(A,["enter"]),ref:"searchInput"},null,544),[[W,p.value]])]),a("button",{class:"rounded px-2 bg-slate-100 dark:bg-neutral-700 hover:bg-blue-300 dark:hover:bg-neutral-500 hover:text-slate-100",onClick:w(k,["stop"])},[n(c,{name:"close-line",class:"leading-6"})])]),a("div",Y,[!l.value||l.value.length<1?(r(),i("div",Z,ae)):(r(),i("ul",oe,[(r(!0),i(y,null,M(l.value,(f,b)=>(r(),i("li",{key:b},[a("a",{onClick:I=>C(f),class:D(["flex m-2 p-2 lg:p-4 hover:bg-blue-400 dark:hover:bg-neutral-600 dark:bg-neutral-700 rounded-lg hover:text-slate-100 shadow-sm",{"bg-slate-100":e.value.bookIdx!==b||e.value.anchorIdx!==-1,"bg-blue-500 dark:bg-neutral-500":e.value.bookIdx===b&&e.value.anchorIdx===-1,"text-slate-100":e.value.bookIdx===b&&e.value.anchorIdx===-1}])},[a("div",le,[n(c,{name:"book-open-line",class:"font-semibold mr-4 p-1 border-2 rounded hover:border-slate-100"}),a("span",null,E(f.title),1)]),n(c,{name:"arrow-right-s-line"})],10,te),f.anchors&&f.anchors.length>0?(r(),i("ul",se,[(r(!0),i(y,null,M(f.anchors,(I,_)=>(r(),i("li",{key:_,class:"pl-4 border-l-2 border-slate-100 dark:border-slate-300"},[a("a",{onClick:ge=>B(f,I),class:D(["flex m-2 p-2 lg:p-4 hover:bg-blue-400 dark:hover:bg-neutral-600 dark:bg-neutral-700 rounded-lg hover:text-slate-100 shadow-sm",{"bg-slate-100":e.value.bookIdx!==b||e.value.anchorIdx!==_,"bg-blue-500 dark:bg-neutral-500":e.value.bookIdx===b&&e.value.anchorIdx===_,"text-slate-100":e.value.bookIdx===b&&e.value.anchorIdx===_}])},[a("div",re,[n(c,{name:"hashtag",class:"font-semibold mr-4 p-1 border-2 rounded hover:border-slate-100"}),a("span",null,E(I.textContent),1)]),n(c,{name:"arrow-right-s-line"})],10,ne)]))),128))])):$("",!0)]))),128))]))]),a("div",de,[n(c,{name:"corner-down-left-line",class:"px-2 mr-2 rounded shadow-sm shadow-slate-700 dark:shadow-slate-300"}),ue,n(c,{name:"arrow-down-line",class:"px-2 mr-2 rounded shadow-sm shadow-slate-700 dark:shadow-slate-300"}),n(c,{name:"arrow-up-line",class:"px-2 mr-2 rounded shadow-sm shadow-slate-700 dark:shadow-slate-300"}),ce])])])):$("",!0)}},he=["onKeydown"],pe=a("span",{class:"px-3 text-normal"},"搜索一切",-1),ve=a("span",{class:"px-1 text-normal bg-slate-200 rounded"},"⌘K",-1),fe=a("span",null,"这是一个测试",-1),me=j({__name:"Search",setup(m){const h=g(!1),d=()=>{h.value=!0},u=s=>{s.key==="k"&&s.metaKey&&(h.value=!0,s.preventDefault())};return L(()=>{document.addEventListener("keydown",u)}),F(()=>{document.removeEventListener("keydown",u)}),(s,p)=>(r(),i(y,null,[a("button",{class:"text-slate-400 px-2 lg:px-4 py-3 my-2",onClick:d,onKeydown:T(w(u,["meta"]),["key"])},[n(c,{name:"search-line"}),pe,ve],40,he),h.value?(r(),G(ie,{key:0,visible:h.value,"onUpdate:visible":p[0]||(p[0]=l=>h.value=l)},{default:q(()=>[fe]),_:1},8,["visible"])):$("",!0)],64))}}),xe={id:"content",class:"w-full max-w-screen-2xl mx-auto"},be={class:"lg:flex"},ke={id:"contentWrapper",class:"min-w-0 w-full flex-auto lg:static lg:max-h-full lg:overflow-visible lg:pl-80"},Te=j({__name:"Books",props:{published:{type:Boolean,default:!1}},setup(m){const h=S(),d=g(!0),u=m,s=l=>{if(l!==void 0){d.value=l;return}d.value=!d.value},p=(l,e)=>{let v=u.published?"/share":"/books";v=l?`${v}/${l}`:v,h.replace({path:v,query:{appId:e}})};return(l,e)=>{const v=P("router-view");return r(),i(y,null,[n(U,{onToggleFold:s,fold:d.value},{default:q(()=>[n(me)]),_:1},8,["fold"]),a("div",xe,[a("div",be,[n(N,{editable:!m.published,share:m.published,onToggleFold:s,fold:d.value,onMenuChange:p},null,8,["editable","share","fold"]),a("div",ke,[n(v)])])])],64)}}});export{Te as default};
