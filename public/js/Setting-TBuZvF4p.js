import{H as _}from"./Header-RLgrfCVI.js";import{ai as y,aj as v,aR as w,aD as n,aE as i,aH as u,aW as b,aX as x,aN as k,b4 as C,aF as f}from"./vendor-7SOp03Eo.js";import{s as g,u as j}from"./userInfo-GWa4mCN8.js";import{b as B}from"./index-DiC8-oKs.js";import{u as U,a as A}from"./user-DjlSiqBu.js";import"./RemixIcon-C3kAUqBT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"flex flex-col items-center justify-center"},$=["src"],H={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-16 h-16 text-gray-400 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},M=u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1),N=[M],R={class:"mt-2 text-sm text-gray-500"},z=y({__name:"AvatarUploader",props:{img:{type:String,default:""},upload:{type:Function,default:()=>null},rounded:{type:Boolean,default:!0}},emits:["remove"],setup(c,{emit:t}){const o=c,d=t,a=v(),e=v(""),r=async l=>{const s=l.target.files[0];if(!s)return;if(!["image/jpeg","image/png"].includes(s.type)){e.value="只允许上传jpeg/png格式的图片";return}if(s.size>2*1024*1024){e.value="图片上传大小不能超过2MB";return}if(o.upload&&await o.upload(s)){const m=new FileReader;m.onload=p=>{a.value=p.target&&p.target.result,e.value=""},m.readAsDataURL(s)}},h=()=>{a.value=null,e.value="",d("remove")};return w(()=>o.img,l=>{l&&(a.value=l)},{immediate:!0}),(l,s)=>(n(),i("div",F,[u("label",{for:"avatar",class:b(["cursor-pointer relative inline-block w-32 h-32 overflow-hidden bg-gray-200",{"border-4 border-dashed border-blue-500":!a.value,"rounded-full":c.rounded}])},[a.value?(n(),i("img",{key:0,src:a.value,class:"w-full h-full object-cover"},null,8,$)):(n(),i("svg",H,N)),u("input",{type:"file",id:"avatar",class:"hidden",accept:"image/*",onChange:r,"accept-charset":"utf-8"},null,32)],2),a.value?(n(),i("button",{key:0,class:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",onClick:h}," 删除 ")):x("",!0),u("p",R,k(e.value),1)]))}}),D={class:"h-screen"},L={class:"p-4"},G={__name:"Setting",setup(c){const t=j(),o=C(()=>{if(t.value&&t.value.avatar)return`${B}/file/preview?file=${t.value.avatar}`}),d=e=>U(t.value._id,e).then(r=>{r&&(t.value=r,g(r))}),a=()=>A(t.value).then(e=>{e&&(t.value=e,g(e))});return(e,r)=>(n(),i("div",D,[f(_,{hiddenFold:!0}),u("div",L,[f(z,{upload:d,img:o.value,onRemove:a},null,8,["img"])])]))}};export{G as default};
