import{au as de,av as ce,ae as b,ak as ve,aL as S,ax as pe,ay as s,az as i,aC as n,aA as f,aS as h,aU as B,aB as A,aQ as L,aT as J,ar as fe,aI as Q,aJ as W,aR as Y,aP as P,aN as w,aW as j,aX as me,aY as he}from"./vendor-BLq22pPX.js";import{c as be,u as xe,r as ye}from"./book-B1UjrR01.js";import{g as _e,B as ge,G as ke,c as Ce,u as Be,r as Te}from"./GroupModal-C7Gvsm3t.js";import{m as V}from"./message-AZuur2LZ.js";import{R as g}from"./RemixIcon-BDA1nEXk.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const k=m=>(me("data-v-bc6ceab9"),m=m(),he(),m),$e={key:0,class:"flex h-14 px-1 sm:px-3 xl:px-5 py-1 pt-4 bg-white/95 lg:bg-transparent"},we=k(()=>n("span",null,"分类",-1)),Me=k(()=>n("span",null,"笔记",-1)),Ge={class:"flex-1 px-1 sm:px-3 xl:px-5 lg:text-sm pb-10 lg:pb-14 bg-white/95 lg:bg-transparent"},Ee=["onUpdate:modelValue","onKeyup"],Se=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Pe={class:"text-base mr-2"},Ve={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Re=["onClick"],Ue=k(()=>n("span",null,"编辑",-1)),De=["onClick"],Ke=k(()=>n("span",null,"删除",-1)),Ne={class:"ml-3"},Fe=["id"],qe=["onUpdate:modelValue","onKeyup"],ze=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Xe={class:"p-2 bg-slate-700 text-white text-sm rounded shadow-md"},Ae={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Le=["onClick"],Je=k(()=>n("span",null,"编辑",-1)),Qe=["onClick"],We=k(()=>n("span",null,"删除",-1)),Ye={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0}},emits:["toggleFold","menuChange"],setup(m,{emit:H}){de();const x=ce(),u=b([]),O=b(x.query.appId),M=b(""),y=b(""),r=b(""),v=b(void 0),d=b(void 0),p=b(!1);let C=null;const{proxy:_}=fe(),T=m,G=b(!0),R=H,E=()=>{G.value=!0,R("toggleFold",!0)},I=e=>{let{id:t}=e||{};M.value=t||"",r.value="",E(),R("menuChange",t,x.query.appId)},Z=()=>{v.value={name:"新增分类"},p.value=!0},ee=e=>{e!=="default"&&(r.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},te=e=>{v.value=e,p.value=!1},oe=()=>{v.value&&p.value?Ce(v.value).then(e=>{let{_id:t,name:l}=e;t&&(u.value.push({id:t,name:l,books:[]}),r.value="",v.value=void 0,p.value=!1)}):v.value&&U(v.value)},U=e=>{Be(e).then(()=>{r.value="",v.value=void 0,p.value=!1})},ae=(e,t)=>{if(e.books&&e.books.length>0){V.warning("该分类下有书籍，不能删除!");return}Te(e.id).then(()=>{V.success("删除分类成功!"),u.value.splice(t,1)})},le=()=>{p.value=!0,d.value={title:"新增笔记",type:T.fixedType||"markdown"}},ne=()=>{d&&p.value?be(d.value).then(e=>{let t=u.value.find(({id:l})=>l===e.category);!t&&(t=u.value.find(({id:l})=>l==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),I(e),d.value=void 0)}):d&&d.value&&K(d.value)},D=()=>{r.value="",d.value=void 0,v.value=void 0,p.value=!1},se=(e,t)=>{let l=e[t];!l||!l.id||ye(l.id).then(()=>{e.splice(t,1);let a=e&&e.length>t?t:e.length-1;I(a<0?null:e[a]),V.success("删除书籍成功!")})},ie=e=>{r.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;t&&t[0]&&t[0].focus()})},ue=e=>{r.value=e.category,d.value=e,p.value=!1},K=e=>{xe({...e,category:e.category==="default"?"":e.category}).then(t=>{r.value,e.category,r.value="",d.value=void 0})};ve(()=>{_e(T.defaultGroup).then(e=>{u.value=e||[],T.defaultSelected&&!x.params.id&&u.value[0]&&u.value[0].books&&u.value[0].books[0]&&I(u.value[0].books[0]),x.params.id&&_.$nextTick(()=>{N(x.params.id||u.value[0].books[0].id)})})});const N=e=>{let t=document.getElementById("sideBar");if(t&&e){let l=document.getElementById(`book-${e}`);l&&t.scrollTo({top:l.offsetTop,behavior:"smooth"})}},F=e=>{y.value=e},q=e=>{y.value=""},z=(e,t)=>{C={x:e.touches[0].clientX,target:t}},X=(e,t)=>{if(!C)return;let{x:l,target:a}=C;if(a!==t){C=null;return}let $=e.changedTouches[0].clientX;l>$?y.value=t:l<$&&(y.value=""),C=null};return S(()=>x.params.id,(e,t)=>{e!==t&&(M.value=e,r.value="",E(),_.$nextTick(()=>{N(e)}))},{immediate:!0}),S(()=>x.query.appId,e=>{O.value=e,console.log(e)},{immediate:!0}),S(()=>T.fold,(e,t)=>{G.value=e},{immediate:!0}),(e,t)=>{const l=pe("tippy");return s(),i("div",{id:"sideBar",class:J(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-20 bg-black/20 lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",G.value?"translate-x-[-100%]":"translate-x-0"]),onClick:h(E,["stop"])},[m.editable?(s(),i("div",$e,[n("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:h(Z,["stop"])},[f(g,{name:"add-line"}),we]),n("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:h(le,["stop"])},[f(g,{name:"add-line"}),Me])])):B("",!0),n("nav",Ge,[n("ul",null,[(s(!0),i(A,null,L(u.value,(a,$)=>(s(),i("li",{key:a.id},[a.id===r.value?Q((s(),i("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":o=>a.name=o,onKeyup:Y(o=>U(a),["enter"])},null,40,Ee)),[[W,a.name]]):(s(),i("div",{key:1,class:"px-3 py-2 relative font-medium text-gray-900 cursor-pointer",onDblclick:h(o=>ee(a.id),["stop"]),onMouseover:o=>F(a.id),onMouseleave:o=>q(a.id),onTouchstartPassive:o=>z(o,a.id),onTouchendPassive:o=>X(o,a.id)},[n("span",Pe,P(a.name),1),f(j,{name:"slide"},{default:w(()=>[y.value===a.id?(s(),i("div",Ve,[m.editable&&!a.readonly?(s(),i("span",{key:0,class:"cursor-pointer bg-blue-300 hover:bg-blue-700 p-2",onClick:h(o=>te(a),["stop"])},[f(g,{name:"edit-line"}),Ue],8,Re)):B("",!0),m.editable&&!a.readonly&&(!a.books||a.books.length<=0)?(s(),i("span",{key:1,class:"cursor-pointer bg-red-300 hover:bg-red-700 p-2",onClick:h(o=>ae(a,$),["stop"])},[f(g,{name:"delete-bin-line"}),Ke],8,De)):B("",!0)])):B("",!0)]),_:2},1024)],40,Se)),n("ul",Ne,[(s(!0),i(A,null,L(a.books,(o,re)=>(s(),i("li",{id:`book-${o.id}`,key:o.id},[o.id===r.value?Q((s(),i("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":c=>o.title=c,onKeyup:Y(c=>K(o),["enter"])},null,40,qe)),[[W,o.title]]):(s(),i("a",{key:1,onClick:h(c=>I(o),["stop"]),onDblclick:h(c=>ie(o.id),["stop"]),onMouseover:c=>F(o.id),onMouseleave:c=>q(o.id),onTouchstartPassive:c=>z(c,o.id),onTouchendPassive:c=>X(c,o.id),class:"px-3 py-2 transition-colors duration-200 relative block text-grey-700 hover:text-gray-900 cursor-pointer"},[f(l,{placement:"top-start",trigger:"hover"},{content:w(()=>[n("span",Xe,P(o.title),1)]),default:w(()=>[n("span",{class:J(["relative inline-block text-base text-ellipsis whitespace-nowrap overflow-hidden",o.id===M.value?"text-blue-500 font-bold":""])},P(o.title),3)]),_:2},1024),f(j,{name:"slide"},{default:w(()=>[m.editable&&o.id===y.value?(s(),i("div",Ae,[n("span",{class:"cursor-pointer bg-blue-300 hover:bg-blue-700 p-2",onClick:h(c=>ue(o),["stop"])},[f(g,{name:"edit-line"}),Je],8,Le),n("span",{class:"cursor-pointer bg-red-300 hover:bg-red-700 p-2",onClick:h(c=>se(a.books,re),["stop"])},[f(g,{name:"delete-bin-line"}),We],8,Qe)])):B("",!0)]),_:2},1024)],40,ze))],8,Fe))),128))])]))),128))])]),f(ge,{fixedType:m.fixedType,title:`${p.value?"新增":"编辑"}书籍`,visible:!!d.value,onConfirm:ne,onCancel:D,book:d.value,categories:u.value},null,8,["fixedType","title","visible","book","categories"]),f(ke,{title:`${p.value?"新增分类":"编辑分类"}`,visible:!!v.value,group:v.value,onConfirm:oe,onCancel:D},null,8,["title","visible","group"])],2)}}},ot=Ie(Ye,[["__scopeId","data-v-bc6ceab9"]]);export{ot as M};
