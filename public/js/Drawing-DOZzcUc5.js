import{N as w,n as g,l as v,m as f,o as x,u as b,D as _,b as D,j as V}from"./tiptap-CwgDY1J2.js";import{bb as k,bc as N,bd as C,be as E,ax as S,ay as a,aE as F,aF as M,aC as d,aL as p,aM as c,az as l,aB as m,aS as y,aI as B,ad as z,aR as A,aA as J,ao as h}from"./vendor-CyQ1aPvD.js";import{a as O}from"./index-BJD_Yrm8.js";import{d as T}from"./utils-_yvyshlj.js";const P=t=>t[Math.floor(Math.random()*t.length)],L={name:"PaperView",components:{NodeViewWrapper:w},props:g,data(){return{color:P(["#A975FF","#FB5151","#FD9170","#FFCB6B","#68CEF8","#80CBC4","#9DEF8F"]),size:Math.ceil(Math.random()*Math.floor(10)),svg:null,path:null,points:[],drawing:!1,id:new Date().getTime()}},methods:{onStartDrawing(t){this.drawing=!0,this.points=[],this.path=this.svg.append("path").data([this.points]).attr("id",`id-${this.id}`).attr("stroke",this.color).attr("stroke-width",this.size);const s=t.type==="mousedown"?"mousemove":"touchmove";this.svg.on(s,this.onMove)},onMove(t){t.preventDefault(),this.points.push(k(t)[0]),this.tick()},onEndDrawing(){this.svg.on("mousemove",null),this.svg.on("touchmove",null),this.drawing&&(this.drawing=!1,this.svg.select(`#id-${this.id}`).remove(),this.id=new Date().getTime())},tick(){requestAnimationFrame(()=>{this.path.attr("d",t=>{const s=N().curve(C)(t),r=this.node.attrs.lines.filter(u=>u.id!==this.id);return this.updateAttributes({lines:[...r,{id:this.id,color:this.color,size:this.size,path:s}]}),s})})},clear(){this.updateAttributes({lines:[]})}},mounted(){this.svg=E(this.$refs.canvas),this.svg.on("mousedown",this.onStartDrawing).on("mouseup",this.onEndDrawing).on("mouseleave",this.onEndDrawing).on("touchstart",this.onStartDrawing).on("touchend",this.onEndDrawing).on("touchleave",this.onEndDrawing)}},R={class:"flex flex-row p-2"},U={class:"bg-slate-50 cursor-crosshair",viewBox:"0 0 500 250",ref:"canvas"},$=["d","id","stroke","stroke-width"];function H(t,s,r,u,n,i){const o=S("node-view-wrapper");return a(),F(o,{class:"draw"},{default:M(()=>[d("div",null,[d("div",R,[p(d("input",{class:"mr-2",type:"color","onUpdate:modelValue":s[0]||(s[0]=e=>n.color=e)},null,512),[[c,n.color]]),p(d("input",{class:"text-sm mr-2",type:"number",min:"1",max:"10","onUpdate:modelValue":s[1]||(s[1]=e=>n.size=e)},null,512),[[c,n.size]]),d("button",{class:"bg-blue-400 text-slate-50 rounded-md px-2 text-sm hover:bg-blue-700",onClick:s[2]||(s[2]=(...e)=>i.clear&&i.clear(...e))}," 清除 ")]),(a(),l("svg",U,[(a(!0),l(m,null,y(t.node.attrs.lines,e=>(a(),l(m,null,[e.id!==n.id?(a(),l("path",{class:"fill-none",key:e.id,d:e.path,id:`id-${e.id}`,stroke:e.color,"stroke-width":e.size},null,8,$)):B("",!0)],64))),256))],512))])]),_:1})}const W=O(L,[["render",H]]),j=v.create({name:"paper",group:"block",atom:!0,addAttributes(){return{lines:{default:[]}}},parseHTML(){return[{tag:'div[data-type="paper"]'}]},renderHTML({HTMLAttributes:t}){return["div",f(t,{"data-type":"paper"})]},addNodeView(){return x(W)}}),q={id:"editorWrapper",class:"min-w-0 flex-auto px-4 sm:px-6 xl:px-8 py-10"},Y=z({__name:"Drawing",props:{modelValue:String},emits:["update:modelValue","update:anchors"],setup(t,{emit:s}){const r=t,u=s,n=T(o=>{const e=o.getJSON();u("update:modelValue",JSON.stringify(e))},300),i=b({content:JSON.parse(r.modelValue||""),editorProps:{attributes:{class:"prose w-full max-w-full focus:outline-none"}},extensions:[_.extend({content:"paper"}),D,j],onUpdate:({editor:o})=>{n(o)}});return A(()=>r.modelValue,o=>{let e=i.value;JSON.stringify(e&&e.getJSON())!==o&&e&&e.commands.setContent(JSON.parse(o||""),!0)}),(o,e)=>(a(),l("div",q,[J(h(V),{class:"h-full",editor:h(i)},null,8,["editor"])]))}});export{Y as default};
