import{au as ve,av as fe,ae as b,aj as he,aM as P,ax as me,ay as l,az as i,aC as s,aA as p,aS as h,aU as T,aB as A,aQ as j,aT as J,ar as be,aJ as L,aK as O,aR as Q,aI as V,aO as w,aW as W,aX as xe,aY as ye}from"./vendor-1hORrrXR.js";import{c as ge,u as Y,r as _e}from"./book-Dm6-ywUB.js";import{g as ke,B as Ce,G as Te,c as Be,u as $e,r as Ie}from"./GroupModal-BDkQSIqb.js";import{m as B}from"./message-ShWl2tYi.js";import{R as y}from"./RemixIcon-DLZgjpvL.js";import{i as H,c as we}from"./utils-Cs41FaCi.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M=m=>(xe("data-v-31a1eab5"),m=m(),ye(),m),Ge={key:0,class:"flex h-14 px-1 sm:px-3 xl:px-5 py-1 pt-4 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Se=M(()=>s("span",null,"分类",-1)),Ee=M(()=>s("span",null,"笔记",-1)),Pe={class:"flex-1 px-1 sm:px-3 xl:px-5 lg:text-sm pb-10 lg:pb-14 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Ve=["onUpdate:modelValue","onKeyup"],Re=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Ue={class:"text-base mr-2"},De={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Ke=["onClick"],Fe=M(()=>s("span",null,"编辑",-1)),Ne=["onClick"],qe=M(()=>s("span",null,"删除",-1)),ze={class:"ml-3"},Xe=["id"],Ae=["onUpdate:modelValue","onKeyup"],je=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Je={class:"p-2 bg-slate-700 text-white text-sm rounded shadow-md"},Le={key:0,class:"absolute right-0 top-3 font-sans text-slate-50"},Oe=["onClick"],Qe=["onClick"],We=["onClick"],Ye={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0}},emits:["toggleFold","menuChange"],setup(m,{emit:Z}){ve();const x=fe(),r=b([]),ee=b(x.query.appId),G=b(""),g=b(""),d=b(""),v=b(void 0),c=b(void 0),f=b(!1);let _=null;const{proxy:k}=be(),$=m,S=b(!0),R=Z,E=()=>{S.value=!0,R("toggleFold",!0)},I=e=>{let{id:t}=e||{};G.value=t||"",d.value="",E(),R("menuChange",t,x.query.appId)},te=()=>{v.value={name:"新增分类"},f.value=!0},ae=e=>{e!=="default"&&(d.value=e,k.$nextTick(()=>{let t=k.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},oe=e=>{v.value=e,f.value=!1},ne=()=>{v.value&&f.value?Be(v.value).then(e=>{let{_id:t,name:n}=e;t&&(r.value.push({id:t,name:n,books:[]}),d.value="",v.value=void 0,f.value=!1)}):v.value&&U(v.value)},U=e=>{$e(e).then(()=>{d.value="",v.value=void 0,f.value=!1})},se=(e,t)=>{if(e.books&&e.books.length>0){B.warning("该分类下有书籍，不能删除!");return}Ie(e.id).then(()=>{B.success("删除分类成功!"),r.value.splice(t,1)})},le=()=>{f.value=!0,c.value={title:"新增笔记",type:$.fixedType||"markdown"}},ie=()=>{c&&f.value?ge(c.value).then(e=>{let t=r.value.find(({id:n})=>n===e.category);!t&&(t=r.value.find(({id:n})=>n==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),I(e),c.value=void 0)}):c&&c.value&&K(c.value)},D=()=>{d.value="",c.value=void 0,v.value=void 0,f.value=!1},ue=(e,t)=>{let n=e[t];!n||!n.id||_e(n.id).then(()=>{e.splice(t,1);let o=e&&e.length>t?t:e.length-1;I(o<0?null:e[o]),B.success("删除书籍成功!")})},re=e=>{d.value=e,k.$nextTick(()=>{let t=k.$refs.titleInput;t&&t[0]&&t[0].focus()})},de=e=>{d.value=e.category,c.value=e,f.value=!1},K=e=>{Y({...e,category:e.category==="default"?"":e.category}).then(t=>{d.value,e.category,d.value="",c.value=void 0})};he(()=>{ke($.defaultGroup).then(e=>{r.value=e||[],$.defaultSelected&&!x.params.id&&r.value[0]&&r.value[0].books&&r.value[0].books[0]&&I(r.value[0].books[0]),x.params.id&&k.$nextTick(()=>{F(x.params.id||r.value[0].books[0].id)})})});const F=e=>{let t=document.getElementById("sideBar");if(t&&e){let n=document.getElementById(`book-${e}`);n&&t.scrollTo({top:n.offsetTop,behavior:"smooth"})}},N=e=>{if(H())return!1;g.value=e},q=e=>{if(H())return!1;g.value=""},z=(e,t)=>{_={x:e.touches[0].clientX,target:t}},X=(e,t)=>{if(!_)return;let{x:n,target:o}=_;if(o!==t){_=null;return}let C=e.changedTouches[0].clientX;if(Math.abs(n-C)<10){_=null;return}n>C?g.value=t:n<C&&(g.value=""),_=null},ce=e=>{e.share=!e.share,Y(e).then(t=>{if(e.share){const n=`${window.location.origin}/#/book/${e.id}`,o=`标题：${e.title}
链接：${n}
`;we(o),B.success("已经复制到剪切板！")}else B.success("取消分享成功！")})};return P(()=>x.params.id,(e,t)=>{e!==t&&(G.value=e,d.value="",E(),k.$nextTick(()=>{F(e)}))},{immediate:!0}),P(()=>x.query.appId,e=>{ee.value=e,console.log(e)},{immediate:!0}),P(()=>$.fold,(e,t)=>{S.value=e},{immediate:!0}),(e,t)=>{const n=me("tippy");return l(),i("div",{id:"sideBar",class:J(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-20 bg-black/20 dark:bg-transparent lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",S.value?"translate-x-[-100%]":"translate-x-0"]),onClick:h(E,["stop"])},[m.editable?(l(),i("div",Ge,[s("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:h(te,["stop"])},[p(y,{name:"add-line"}),Se]),s("button",{class:"font-sans-serif text-base text-blue-300 hover:text-blue-700 border border-blue-300 hover:border-blue-700 rounded px-2 mx-2",onClick:h(le,["stop"])},[p(y,{name:"add-line"}),Ee])])):T("",!0),s("nav",Pe,[s("ul",null,[(l(!0),i(A,null,j(r.value,(o,C)=>(l(),i("li",{key:o.id},[o.id===d.value?L((l(),i("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":a=>o.name=a,onKeyup:Q(a=>U(o),["enter"])},null,40,Ve)),[[O,o.name]]):(l(),i("div",{key:1,class:"px-3 py-2 relative font-medium text-gray-900 dark:text-gray-50 cursor-pointer",onDblclick:h(a=>ae(o.id),["stop"]),onMouseover:a=>N(o.id),onMouseleave:a=>q(o.id),onTouchstartPassive:a=>z(a,o.id),onTouchendPassive:a=>X(a,o.id)},[s("span",Ue,V(o.name),1),p(W,{name:"fade"},{default:w(()=>[g.value===o.id?(l(),i("div",De,[m.editable&&!o.readonly?(l(),i("span",{key:0,class:"cursor-pointer bg-blue-300 hover:bg-blue-700 p-2",onClick:h(a=>oe(o),["stop"])},[p(y,{name:"edit-line"}),Fe],8,Ke)):T("",!0),m.editable&&!o.readonly&&(!o.books||o.books.length<=0)?(l(),i("span",{key:1,class:"cursor-pointer bg-red-300 hover:bg-red-700 p-2",onClick:h(a=>se(o,C),["stop"])},[p(y,{name:"delete-bin-line"}),qe],8,Ne)):T("",!0)])):T("",!0)]),_:2},1024)],40,Re)),s("ul",ze,[(l(!0),i(A,null,j(o.books,(a,pe)=>(l(),i("li",{id:`book-${a.id}`,key:a.id},[a.id===d.value?L((l(),i("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":u=>a.title=u,onKeyup:Q(u=>K(a),["enter"])},null,40,Ae)),[[O,a.title]]):(l(),i("a",{key:1,onClick:h(u=>I(a),["stop"]),onDblclick:h(u=>re(a.id),["stop"]),onMouseover:u=>N(a.id),onMouseleave:u=>q(a.id),onTouchstartPassive:u=>z(u,a.id),onTouchendPassive:u=>X(u,a.id),class:"px-3 py-2 transition-colors duration-200 relative block text-grey-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-50 cursor-pointer"},[p(n,{placement:"top-start",trigger:"hover"},{content:w(()=>[s("span",Je,V(a.title),1)]),default:w(()=>[s("span",{class:J(["relative inline-block text-base text-ellipsis whitespace-nowrap overflow-hidden",a.id===G.value?"text-blue-500 font-bold":""])},V(a.title),3)]),_:2},1024),p(W,{name:"fade"},{default:w(()=>[m.editable&&a.id===g.value?(l(),i("div",Le,[s("span",{class:"cursor-pointer bg-slate-300 hover:bg-slate-500 p-2",onClick:h(u=>ce(a),["stop"])},[p(y,{name:a.share?"eye-off-line":"share-line"},null,8,["name"])],8,Oe),s("span",{class:"cursor-pointer bg-blue-300 hover:bg-blue-500 p-2",onClick:h(u=>de(a),["stop"])},[p(y,{name:"edit-line"})],8,Qe),s("span",{class:"cursor-pointer bg-red-300 hover:bg-red-500 p-2",onClick:h(u=>ue(o.books,pe),["stop"])},[p(y,{name:"delete-bin-line"})],8,We)])):T("",!0)]),_:2},1024)],40,je))],8,Xe))),128))])]))),128))])]),p(Ce,{fixedType:m.fixedType,title:`${f.value?"新增":"编辑"}书籍`,visible:!!c.value,onConfirm:ie,onCancel:D,book:c.value,categories:r.value},null,8,["fixedType","title","visible","book","categories"]),p(Te,{title:`${f.value?"新增分类":"编辑分类"}`,visible:!!v.value,group:v.value,onConfirm:ne,onCancel:D},null,8,["title","visible","group"])],2)}}},st=Me(Ye,[["__scopeId","data-v-31a1eab5"]]);export{st as M};
