import{H as _}from"./Header-PYXapPSr.js";import{ai as w,aj as v,aR as y,aD as n,aE as i,aH as u,aY as b,aZ as x,aN as k,b3 as C,aF as f}from"./vendor-Ca624vxD.js";import{s as g,u as j}from"./userInfo-CpJIz3bh.js";import{b as U}from"./index-D5Zmbx3T.js";import{u as A,a as B}from"./user-Ugs0z67X.js";import"./RemixIcon-Cy7WqHn8.js";const F={class:"flex flex-col items-center justify-center"},$=["src"],H={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-16 h-16 text-gray-400 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},M=u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1),N=[M],R={class:"mt-2 text-sm text-gray-500"},z=w({__name:"AvatarUploader",props:{img:{type:String,default:""},upload:{type:Function,default:()=>null}},emits:["remove"],setup(d,{emit:a}){const o=d,c=a,t=v(),e=v(""),r=async l=>{const s=l.target.files[0];if(!s)return;if(!["image/jpeg","image/png"].includes(s.type)){e.value="只允许上传jpeg/png格式的图片";return}if(s.size>2*1024*1024){e.value="图片上传大小不能超过2MB";return}if(o.upload&&await o.upload(s)){const m=new FileReader;m.onload=p=>{t.value=p.target&&p.target.result,e.value=""},m.readAsDataURL(s)}},h=()=>{t.value=null,e.value="",c("remove")};return y(()=>o.img,l=>{l&&(t.value=l)},{immediate:!0}),(l,s)=>(n(),i("div",F,[u("label",{for:"avatar",class:b(["cursor-pointer relative inline-block w-32 h-32 rounded-full overflow-hidden bg-gray-200",{"border-4 border-dashed border-blue-500":!t.value}])},[t.value?(n(),i("img",{key:0,src:t.value,class:"w-full h-full object-cover"},null,8,$)):(n(),i("svg",H,N)),u("input",{type:"file",id:"avatar",class:"hidden",accept:"image/*",onChange:r,"accept-charset":"utf-8"},null,32)],2),t.value?(n(),i("button",{key:0,class:"mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",onClick:h}," 删除头像 ")):x("",!0),u("p",R,k(e.value),1)]))}}),D={class:"h-screen"},L={class:"p-4"},q={__name:"Setting",setup(d){const a=j(),o=C(()=>{if(a.value&&a.value.avatar)return`${U}/file/download?file=${a.value.avatar}`}),c=e=>A(a.value._id,e).then(r=>{r&&(a.value=r,g(r))}),t=()=>B(a.value).then(e=>{e&&(a.value=e,g(e))});return(e,r)=>(n(),i("div",D,[f(_,{hiddenFold:!0}),u("div",L,[f(z,{upload:c,img:o.value,onRemove:t},null,8,["img"])])]))}};export{q as default};
