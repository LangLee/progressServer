import{B as H,E as B,S as T,V as L,D as I,u as S,a as M,H as D,T as E,b as q,c as z,d as O,C as P,p as V,P as N,I as U,i as j,e as F,f as K,g as W,h as Y,j as Q}from"./tiptap-CB3Ftz3M.js";import{au as Z,av as G,aL as x,ay as m,az as f,aB as k,aQ as R,b3 as J,aC as r,aM as p,aU as A,b4 as X,aP as $,aT as u,aS as _,T as ee,aN as te,aA as l,ao as w,ac as oe,ad as ne,b5 as ae,b6 as ie,b7 as re,b8 as se,b9 as le,ag as de}from"./vendor-BSAPUjJi.js";import{_ as d}from"./RemixIcon-Cb0msOyL.js";import{a as ce}from"./ai-B9sis56A.js";import{m as ue}from"./message-CIMfOfme.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as me}from"./utils-_yvyshlj.js";const he={class:"flex flex-col justify-between overflow-y-auto sticky max-h-(screen-18) pb-6 top-18"},fe={key:0,class:"text-slate-600 text-sm leading-6 px-4"},ve=r("p",{class:"font-semibold text-gray-900 leading-8"},"概要",-1),be=["onClick"],ye={key:1,class:"text-slate-300 text-sm"},we=r("p",null,"写点啥才能有概要...",-1),xe=[we],ke={__name:"TableOfContent",props:{editor:{type:Object,default:()=>({})},anchors:{type:Array,default:()=>[]}},setup(t){const o=Z(),e=G(),c=t,n=i=>{if(c.editor){const g=c.editor.view.dom.querySelector(`[data-toc-id="${i.id}"`);if(!g)return;c.editor.view.posAtDOM(g,0);const a=c.editor.view.state.tr;a.setSelection(new ee(a.doc.resolve(i.pos||0))),c.editor.view.dispatch(a),c.editor.view.focus(),o.replace({path:e.path,params:e.params,query:{appId:e.query.appId,anchorId:i.id}}),window.scrollTo({top:g.getBoundingClientRect().top+window.scrollY-64,behavior:"smooth"})}};return x(()=>e.query.anchorId,(i,g)=>{i&&i!==g&&n({id:i,pos:0})},{immediate:!0}),(i,g)=>(m(),f("div",he,[t.anchors&&t.anchors.length>0?(m(),f("ul",fe,[ve,(m(!0),f(k,null,R(t.anchors,a=>(m(),f("li",{key:"item.id",class:"border-l-2",style:J({paddingLeft:a.level+"rem"})},[r("a",{class:u(["block py-1 font-medium cursor-pointer",{"text-blue-500":a.isActive,"hover:text-blue-300":!a.isActive,"text-slate-400":a.isScrolledOver&&!a.isActive}]),onClick:_(s=>n(a),["stop"])},[a.level>1?(m(),p(d,{key:0,name:"arrow-right-s-line"})):A("",!0),X(" "+$(a.textContent),1)],10,be)],4))),128))])):(m(),f("div",ye,xe))]))}},Ce=ke,Re={class:"flex flex-row flex-wrap"},pe=["disabled"],Ae=["disabled"],$e=["disabled"],He={class:"flex flex-row flex-wrap"},Be={class:"flex flex-row flex-wrap"},Te={class:"flex flex-row flex-wrap"},Le=["disabled"],Ie={class:"flex flex-row flex-wrap"},Se={class:"flex flex-row flex-wrap"},Me={__name:"BubbleMenu",props:{editor:{type:Object,default:null}},setup(t){const o=t,e=()=>{var b,y;let{doc:c,selection:n}=((y=(b=o.editor)==null?void 0:b.view)==null?void 0:y.state)||{},{from:i,to:g}=n||{},a=c.textBetween(n.from,n.to,`
`);(i===g||!a)&&ue.warning("请选择要翻译的文本！");const h=new RegExp(/^[a-zA-Z/s]*$/).test(a);ce({query:a,from:h?"en":"zh-CHS",to:h?"zh-CHS":"en"}).then(v=>{let C=v.translation;C!==a&&o.editor.commands.insertContentAt(g,`<em>[翻译：${C}]</em>`)})};return(c,n)=>t.editor?(m(),p(w(H),{key:0,editor:t.editor,class:"flex flex-col flex-wrap shadow-lg p-2 bg-white"},{default:te(()=>[r("div",Re,[r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("bold"),"bg-gray-50":!t.editor.isActive("bold")}]),onClick:n[0]||(n[0]=i=>t.editor.chain().focus().toggleBold().run()),disabled:!t.editor.can().chain().focus().toggleBold().run()},[l(d,{name:"bold"})],10,pe),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("italic"),"bg-gray-50":!t.editor.isActive("italic")}]),onClick:n[1]||(n[1]=i=>t.editor.chain().focus().toggleItalic().run()),disabled:!t.editor.can().chain().focus().toggleItalic().run()},[l(d,{name:"italic"})],10,Ae),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("strike"),"bg-gray-50":!t.editor.isActive("strike")}]),onClick:n[2]||(n[2]=i=>t.editor.chain().focus().toggleStrike().run()),disabled:!t.editor.can().chain().focus().toggleStrike().run()},[l(d,{name:"strikethrough"})],10,$e),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("paragraph"),"bg-gray-50":!t.editor.isActive("paragraph")}]),onClick:n[3]||(n[3]=i=>t.editor.chain().focus().setParagraph().run())},[l(d,{name:"paragraph"})],2)]),r("div",He,[r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("heading",{level:1}),"bg-gray-50":!t.editor.isActive("heading",{level:1})}]),onClick:n[4]||(n[4]=i=>t.editor.chain().focus().toggleHeading({level:1}).run())},[l(d,{name:"h-1"})],2),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("heading",{level:2}),"bg-gray-50":!t.editor.isActive("heading",{level:2})}]),onClick:n[5]||(n[5]=i=>t.editor.chain().focus().toggleHeading({level:2}).run())},[l(d,{name:"h-2"})],2),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("heading",{level:3}),"bg-gray-50":!t.editor.isActive("heading",{level:3})}]),onClick:n[6]||(n[6]=i=>t.editor.chain().focus().toggleHeading({level:3}).run())},[l(d,{name:"h-3"})],2),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("heading",{level:4}),"bg-gray-50":!t.editor.isActive("heading",{level:4})}]),onClick:n[7]||(n[7]=i=>t.editor.chain().focus().toggleHeading({level:4}).run())},[l(d,{name:"h-4"})],2),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("heading",{level:5}),"bg-gray-50":!t.editor.isActive("heading",{level:5})}]),onClick:n[8]||(n[8]=i=>t.editor.chain().focus().toggleHeading({level:5}).run())},[l(d,{name:"h-5"})],2),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("heading",{level:6}),"bg-gray-50":!t.editor.isActive("heading",{level:6})}]),onClick:n[9]||(n[9]=i=>t.editor.chain().focus().toggleHeading({level:6}).run())},[l(d,{name:"h-6"})],2)]),r("div",Be,[r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("bulletList"),"bg-gray-50":!t.editor.isActive("bulletList")}]),onClick:n[10]||(n[10]=i=>t.editor.chain().focus().toggleBulletList().run())},[l(d,{name:"list-unordered"})],2),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("orderedList"),"bg-gray-50":!t.editor.isActive("orderedList")}]),onClick:n[11]||(n[11]=i=>t.editor.chain().focus().toggleOrderedList().run())},[l(d,{name:"list-ordered"})],2)]),r("div",Te,[r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("code"),"bg-gray-50":!t.editor.isActive("code")}]),onClick:n[12]||(n[12]=i=>t.editor.chain().focus().toggleCode().run()),disabled:!t.editor.can().chain().focus().toggleCode().run()},[l(d,{name:"code-view"})],10,Le),r("div",{class:u(["m-1 px-1 rounded-sm shadow hover:bg-gray-300 cursor-pointer",{"bg-gray-300":t.editor.isActive("codeBlock"),"bg-gray-50":!t.editor.isActive("codeBlock")}]),onClick:n[13]||(n[13]=i=>t.editor.chain().focus().toggleCodeBlock().run())},[l(d,{name:"code-block"})],2)]),r("div",Ie,[r("div",{class:"m-1 px-1 rounded-sm shadow bg-gray-50 hover:bg-gray-300 cursor-pointer",onClick:n[14]||(n[14]=i=>t.editor.chain().focus().toggleBlockquote().run())},[l(d,{name:"quote-text"})]),r("div",{class:"m-1 px-1 rounded-sm shadow bg-gray-50 hover:bg-gray-300 cursor-pointer",onClick:n[15]||(n[15]=i=>t.editor.chain().focus().setHorizontalRule().run())},[l(d,{name:"separator"})]),r("div",{class:"m-1 px-1 rounded-sm shadow bg-gray-50 hover:bg-gray-300 cursor-pointer",onClick:n[16]||(n[16]=i=>t.editor.chain().focus().setHardBreak().run())},[l(d,{name:"text-wrap"})])]),r("div",Se,[r("div",{class:"m-1 px-1 rounded-sm shadow bg-gray-50 hover:bg-gray-300 cursor-pointer",onMousedown:e},[l(d,{name:"translate"})],32)])]),_:1},8,["editor"])):A("",!0)}},De=Me,Ee=B.create({name:"commands",addOptions(){return{suggestion:{char:"/",command:({editor:t,range:o,props:e})=>{e.command({editor:t,range:o})}}}},addProseMirrorPlugins(){return[T({editor:this.editor,...this.options.suggestion})]}}),qe={props:{items:{type:Array,required:!0},command:{type:Function,required:!0}},data(){return{selectedIndex:0}},watch:{items(){this.selectedIndex=0}},methods:{onKeyDown({event:t}){return t.key==="ArrowUp"?(this.upHandler(),!0):t.key==="ArrowDown"?(this.downHandler(),!0):t.key==="Enter"?(this.enterHandler(),!0):!1},upHandler(){this.selectedIndex=(this.selectedIndex+this.items.length-1)%this.items.length},downHandler(){this.selectedIndex=(this.selectedIndex+1)%this.items.length},enterHandler(){this.selectItem(this.selectedIndex)},selectItem(t){const o=this.items[t];o&&this.command(o)}}},ze={class:"relative border rounded-md overflow-hidden p-1 bg-white shadow-md text-slate-700 min-w-28"},Oe=["onClick"],Pe={key:1,class:"block px-2 w-full text-left"};function Ve(t,o,e,c,n,i){return m(),f("div",ze,[e.items.length?(m(!0),f(k,{key:0},R(e.items,(g,a)=>(m(),f("button",{class:u(["block px-2 w-full border rounded-md text-left",{"border-transparent":a!==n.selectedIndex,"border-blue-500":a===n.selectedIndex}]),key:a,onClick:s=>i.selectItem(a)},$(g.title),11,Oe))),128)):(m(),f("div",Pe," No result "))])}const Ne=ge(qe,[["render",Ve]]),Ue={items:({query:t})=>[{title:"H1",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHeading({level:1}).run()}},{title:"H2",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHeading({level:2}).run()}},{title:"H3",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHeading({level:3}).run()}},{title:"H4",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHeading({level:4}).run()}},{title:"H5",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHeading({level:5}).run()}},{title:"H6",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHeading({level:6}).run()}},{title:"bold",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleBold().run()}},{title:"italic",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleItalic().run()}},{title:"strike",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleStrike().run()}},{title:"paragraph",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleParagraph().run()}},{title:"highlight",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleHighlight().run()}},{title:"bulletList",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleBulletList().run()}},{title:"orderedList",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleOrderedList().run()}},{title:"code",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleCode().run()}},{title:"codeBlock",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleCodeBlock().run()}},{title:"blockquote",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleBlockquote().run()}},{title:"horizontal",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).setHorizontalRule().run()}},{title:"hardBreak",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).setHardBreak().run()}},{title:"task",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).toggleTaskList().run()}},{title:"insertTable",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).insertTable({rows:3,cols:3,withHeaderRow:!0}).run()}},{title:"addTableColumnBefore",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).addColumnBefore().run()}},{title:"addTableColumnAfter",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).addColumnAfter().run()}},{title:"deleteTableColumn",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).deleteColumn().run()}},{title:"addTableRowBefore",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).addRowBefore().run()}},{title:"addTableRowAfter",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).addRowAfter().run()}},{title:"deleteTableRow",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).deleteRow().run()}},{title:"deleteTable",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).deleteTable().run()}},{title:"deleteNode",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).deleteNode().run()}},{title:"clearMarks",command:({editor:o,range:e})=>{o.chain().focus().deleteRange(e).unsetAllMarks().run()}}].filter(o=>o.title.toLowerCase().includes(t.toLowerCase())).slice(0,10),render:()=>{let t,o;return{onStart:e=>{t=new L(Ne,{props:e,editor:e.editor}),e.clientRect&&(o=oe("body",{getReferenceClientRect:e.clientRect,appendTo:()=>document.body,content:t.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(e){t.updateProps(e),e.clientRect&&o[0].setProps({getReferenceClientRect:e.clientRect})},onKeyDown(e){var c;return e.event.key==="Escape"?(o[0].hide(),!0):(c=t.ref)==null?void 0:c.onKeyDown(e)},onExit(){o[0].destroy(),t.destroy()}}}},je={id:"editorWrapper",class:"min-w-0 flex-auto px-4 sm:px-6 xl:px-8 py-10 xl:mr-80"},Fe={id:"tableOfContent",class:"fixed z-20 top-[3.8125rem] bottom-0 right-0 py-10 overflow-y-auto hidden xl:text-sm xl:block flex-none w-80 px-8"},Xe=ne({__name:"Markdown",props:{modelValue:String,editable:{type:Boolean,default:!0},anchors:Array},emits:["update:modelValue","update:anchors"],setup(t,{emit:o}){const e=I.extend({content:"heading block*"}),c=ae();c.register({html:ie,css:re,js:se,ts:le});const n=t,i=o,g=me(s=>{i("update:modelValue",s.getHTML())},300),a=S({editable:n.editable,content:n.modelValue,editorProps:{attributes:{class:"prose w-full max-w-full focus:outline-none"}},extensions:[e,M.configure({document:!1}),D,E,q,z,O.configure({nested:!0}),P.configure({lowlight:c}),V.configure({onUpdate:s=>{i("update:anchors",s)}}),N.configure({emptyEditorClass:"is-editor-empty",placeholder:({node:s})=>s.type.name==="heading"?"What’s the title?":"Can you add some further context?"}),U.configure({inline:!0,allowBase64:!0}),j.configure({allowedMimeTypes:["image/png","image/jpeg","image/gif","image/webp"],onDrop:(s,h,b)=>{h.forEach(y=>{const v=new FileReader;v.readAsDataURL(y),v.onload=()=>{s.chain().insertContentAt(b,{type:"image",attrs:{src:v.result}}).focus().run()}})},onPaste:(s,h,b)=>{h.forEach(y=>{if(b)return console.log(b),!1;const v=new FileReader;v.readAsDataURL(y),v.onload=()=>{s.chain().insertContentAt(s.state.selection.anchor,{type:"image",attrs:{src:v.result}}).focus().run()}})}}),Ee.configure({suggestion:Ue}),F.configure({resizable:!0}),K,W,Y],onUpdate:({editor:s})=>{g(s)}});return x(()=>n.modelValue,s=>{a.value&&a.value.getHTML()===s||a.value&&a.value.commands.setContent(s||"",!0)}),x(()=>n.editable,(s,h)=>{s!==h&&a.value&&a.value.setEditable(s)}),de(()=>{a.value&&a.value.destroy()}),(s,h)=>(m(),f(k,null,[r("div",je,[l(De,{editor:w(a)},null,8,["editor"]),l(w(Q),{class:"h-full",editor:w(a)},null,8,["editor"])]),r("div",Fe,[l(Ce,{editor:w(a),anchors:t.anchors},null,8,["editor","anchors"])])],64))}});export{Xe as default};
