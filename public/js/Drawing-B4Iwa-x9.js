import{N as w,n as f,a as v,m as b,b as x,u as _,D,q as V,l as k}from"./tiptap-DZtZPlcx.js";import{bg as E,bh as N,bi as C,bj as S,aC as F,aD as i,aS as y,aT as B,aH as d,aO as p,aP as c,aE as l,aG as h,aV as M,aZ as z,ai as O,aR as m,aF as T,at as g}from"./vendor-Ca624vxD.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as J}from"./utils-BIo_BOvM.js";const P=t=>t[Math.floor(Math.random()*t.length)],H={name:"PaperView",components:{NodeViewWrapper:w},props:f,data(){return{color:P(["#A975FF","#FB5151","#FD9170","#FFCB6B","#68CEF8","#80CBC4","#9DEF8F"]),size:Math.ceil(Math.random()*Math.floor(10)),svg:null,path:null,points:[],drawing:!1,id:new Date().getTime()}},methods:{onStartDrawing(t){this.drawing=!0,this.points=[],this.path=this.svg.append("path").data([this.points]).attr("id",`id-${this.id}`).attr("stroke",this.color).attr("stroke-width",this.size);const s=t.type==="mousedown"?"mousemove":"touchmove";this.svg.on(s,this.onMove)},onMove(t){t.preventDefault(),this.points.push(E(t)[0]),this.tick()},onEndDrawing(){this.svg.on("mousemove",null),this.svg.on("touchmove",null),this.drawing&&(this.drawing=!1,this.svg.select(`#id-${this.id}`).remove(),this.id=new Date().getTime())},tick(){requestAnimationFrame(()=>{this.path.attr("d",t=>{const s=N().curve(C)(t),a=this.node.attrs.lines.filter(u=>u.id!==this.id);return this.updateAttributes({lines:[...a,{id:this.id,color:this.color,size:this.size,path:s}]}),s})})},clear(){this.updateAttributes({lines:[]})}},mounted(){this.svg=S(this.$refs.canvas),this.svg.on("mousedown",this.onStartDrawing).on("mouseup",this.onEndDrawing).on("mouseleave",this.onEndDrawing).on("touchstart",this.onStartDrawing).on("touchend",this.onEndDrawing).on("touchleave",this.onEndDrawing)}},L={class:"flex flex-row p-2"},R={class:"bg-slate-50 cursor-crosshair",viewBox:"0 0 500 250",ref:"canvas"},U=["d","id","stroke","stroke-width"];function $(t,s,a,u,n,r){const o=F("node-view-wrapper");return i(),y(o,{class:"draw"},{default:B(()=>[d("div",null,[d("div",L,[p(d("input",{class:"mr-2",type:"color","onUpdate:modelValue":s[0]||(s[0]=e=>n.color=e)},null,512),[[c,n.color]]),p(d("input",{class:"text-sm mr-2",type:"number",min:"1",max:"10","onUpdate:modelValue":s[1]||(s[1]=e=>n.size=e)},null,512),[[c,n.size]]),d("button",{class:"bg-blue-400 text-slate-50 rounded-md px-2 text-sm hover:bg-blue-700",onClick:s[2]||(s[2]=(...e)=>r.clear&&r.clear(...e))}," 清除 ")]),(i(),l("svg",R,[(i(!0),l(h,null,M(t.node.attrs.lines,e=>(i(),l(h,null,[e.id!==n.id?(i(),l("path",{class:"fill-none",key:e.id,d:e.path,id:`id-${e.id}`,stroke:e.color,"stroke-width":e.size},null,8,U)):z("",!0)],64))),256))],512))])]),_:1})}const q=A(H,[["render",$]]),W=v.create({name:"paper",group:"block",atom:!0,addAttributes(){return{lines:{default:[]}}},parseHTML(){return[{tag:'div[data-type="paper"]'}]},renderHTML({HTMLAttributes:t}){return["div",b(t,{"data-type":"paper"})]},addNodeView(){return x(q)}}),j={id:"editorWrapper",class:"min-w-0 flex-auto px-4 sm:px-6 xl:px-8 py-10"},X=O({__name:"Drawing",props:{modelValue:String,editable:{type:Boolean,default:!0}},emits:["update:modelValue","update:anchors"],setup(t,{emit:s}){const a=t,u=s,n=J(o=>{const e=o.getJSON();u("update:modelValue",JSON.stringify(e))},300),r=_({editable:a.editable,content:JSON.parse(a.modelValue||""),editorProps:{attributes:{class:"prose w-full max-w-full focus:outline-none"}},extensions:[D.extend({content:"paper"}),V,W],onUpdate:({editor:o})=>{n(o)}});return m(()=>a.modelValue,o=>{let e=r.value;JSON.stringify(e&&e.getJSON())!==o&&e&&e.commands.setContent(JSON.parse(o||""),!0)}),m(()=>a.editable,(o,e)=>{o!==e&&r.value&&r.value.setEditable(o)}),(o,e)=>(i(),l("div",j,[T(g(k),{class:"h-full",editor:g(r)},null,8,["editor"])]))}});export{X as default};
