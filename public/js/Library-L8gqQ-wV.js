import{C as _}from"./Card-iLg7ySo8.js";import{d as w}from"./index-bEem1MK9.js";import{P as V}from"./ProInput-DLzwbHQE.js";import{aj as p,aW as $,az as d,a_ as B,a$ as E,aG as m,ap as P,aA as v,aD as b,aO as g,b2 as U,au as y}from"./vendor-DqHIQWU1.js";import{H as j}from"./Header-jlxeZXVD.js";import{g as M,c as R,u as F,r as H,p as I}from"./app-ECC3QMWu.js";import{m as A}from"./message-DsTL7g5X.js";import{u as L}from"./userInfo-CSbayTML.js";import"./utils-DVDKZiQc.js";import"./remixicon-l0sNRNKZ.js";/* empty css                                                                 */import"./user-BZG51SbY.js";import"./file-D7E9LNHg.js";const N={__name:"BookCollectionModal",props:{title:{type:String,default:"新增图书"},visible:{type:Boolean,default:!1},app:{type:Object,default:()=>({name:"",title:""})}},emits:["update:app","confirm","cancel"],setup(n,{emit:o}){const t=n,l=o,a=p(t.visible),c=()=>{l("confirm"),a.value=!1},f=()=>{l("cancel"),a.value=!1};return $(()=>t.visible,()=>{a.value=t.visible}),(h,i)=>(d(),B(w,{title:n.title,visible:a.value,"onUpdate:visible":i[1]||(i[1]=u=>a.value=u),onConfirm:c,onCancel:f},{default:E(()=>[m(V,{class:"lg:my-2",name:"name",modelValue:n.app.title,"onUpdate:modelValue":i[0]||(i[0]=u=>n.app.title=u),placeholder:"请输入图书标题"},null,8,["modelValue"])]),_:1},8,["title","visible"]))}},O={class:"w-full flex flex-col overflow-y-auto"},S={class:"w-full flex p-2 lg:p-4 flex-wrap justify-start max-w-screen-2xl mx-auto"},z={class:"flex flex-col items-center p-2 lg:p-4 basis-1/4 md:basis-1/6 lg:basis-1/12"},te={__name:"Library",setup(n){const o=p([]),t=p(!1),l=p(void 0),a=p(!1),c=L(),f=()=>{a.value=!0,l.value={title:"新增",icon:"book-2-fill",inner:!0,url:"/books"},t.value=!0},h=e=>{a.value=!1,l.value=e,t.value=!0},i=async()=>{a.value?await R(l.value).then(e=>{o.value.push(e),a.value=!1}):await F(l.value).catch(e=>{A.error(e)}),t.value=!1},u=()=>{a.value=!1,l.value=void 0,t.value=!1},C=e=>{H(e).then(r=>{o.value=o.value.filter(s=>s._id!==e)})},k=e=>{e.published=!e.published,I(e).catch(r=>{A.error(r)})};return P(()=>{M("user","/books").then(e=>{o.value=e||[]})}),(e,r)=>(d(),v(g,null,[b("div",O,[m(j,{hiddenFold:!0}),b("div",S,[(d(!0),v(g,null,U(o.value,(s,D)=>(d(),v("div",{key:s._id,class:"flex flex-col items-center p-2 lg:p-4 basis-1/4 md:basis-1/6 lg:basis-1/12"},[m(_,{publishable:!0,editable:!0,modelValue:s,theme:"blue",onEdit:x=>h(s),onRemove:x=>C(s._id),onPublish:x=>k(s)},null,8,["modelValue","onEdit","onRemove","onPublish"])]))),128)),b("div",z,[m(_,{theme:"blue",modelValue:{title:"新增图书",icon:"add-line"},onCardClick:f})])])]),m(N,{title:`${a.value?"新增图书":"编辑图书"}`,visible:t.value,app:l.value,"onUpdate:app":r[0]||(r[0]=s=>l.value=s),onConfirm:i,onCancel:u,system:y(c)&&y(c).administrator},null,8,["title","visible","app","system"])],64))}};export{te as default};
