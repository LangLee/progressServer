import{_ as w,m as H,d as G}from"./index-bEem1MK9.js";import"./remixicon-l0sNRNKZ.js";import{H as J}from"./Header-jlxeZXVD.js";import{_ as W}from"./ChatPanel-DWOakeds.js";import"./Menu-ynX6Yh31.js";import{g as Q}from"./ai-BzmOfZ_l.js";import{g as Y,_ as Z,r as ee,c as te,u as oe}from"./PromptModal-CoDoiaRN.js";import{aj as u,az as l,aA as c,aD as p,aG as h,aE as V,aF as _,aH as M,aO as L,b2 as j,a_ as R,a$ as q,aX as B,b3 as ae,ap as A,aK as se,aL as le,ak as re,aW as ne,b1 as ie,aB as ue}from"./vendor-DqHIQWU1.js";import{u as ce,r as de,b as pe,g as me}from"./book-J-0CnIOg.js";import{m as ve}from"./message-DsTL7g5X.js";import{i as O}from"./utils-DVDKZiQc.js";import"./userInfo-CSbayTML.js";import"./file-D7E9LNHg.js";import"./user-BZG51SbY.js";import"./no-data-ou6-36FL.js";import"./Question-DbNPOHdm.js";import"./oneNote-D4VVWFj3.js";/* empty css                                                                */import"./GroupModal-DcQdgpqj.js";import"./ProInput-DLzwbHQE.js";/* empty css                                                                 */const he={key:0,class:"h-8 leading-8"},fe={key:1,class:"text-slate-500"},ge={__name:"EditItem",props:{modelValue:{type:Object,required:!0},editable:{type:Boolean,default:!0},titleProperty:{type:String,default:"title"},subTitleProperty:{type:String,default:"subTitle"}},emits:["skip","edit","remove"],setup(s,{emit:T}){let t=0;const o=s,n=T,r=u(!1),a=()=>{n("skip",o.modelValue)},i=()=>{if(O())return!0;r.value=!0},d=()=>{if(O())return!0;r.value=!1},f=v=>{t=v.touches[0].clientX},m=v=>{if(!t)return!0;let P=v.changedTouches[0].clientX;if(Math.abs(t-P)<10)return t=0,!0;t>P?r.value=!0:t<P&&(r.value=!1),t=0},g=()=>{n("edit",o.modelValue)},x=()=>{H.confirm({title:"确认删除",content:"确认删除该内容？",onOk:()=>{n("remove",o.modelValue)}})};return(v,P)=>(l(),c("div",{class:"flex flex-row w-full justify-between items-center h-12 leading-[3rem] border border-gray-300/20 bg-white/90 dark:bg-neutral-900 m-1 px-4 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:_(a,["stop"]),onMouseover:_(i,["stop"]),onMouseleave:_(d,["stop"]),onTouchstartPassive:f,onTouchendPassive:m},[p("span",null,[h(w,{class:"text-blue-300 mr-2",name:"chat-smile-2-line"}),p("span",null,V(s.modelValue[s.titleProperty]),1)]),s.editable&&r.value?(l(),c("span",he,[p("button",{class:"px-1 lg:px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-500 hover:text-gray-700",onClick:_(g,["stop"])},[h(w,{name:"edit-2-fill"})]),p("button",{class:"px-1 lg:px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-500 hover:text-gray-700",onClick:_(x,["stop"])},[h(w,{name:"delete-bin-fill"})])])):s.modelValue[s.subTitleProperty]?(l(),c("span",fe,V(s.modelValue[s.subTitleProperty]),1)):M("",!0)],32))}},be={class:"w-full bg-white/40 dark:bg-neutral-700/40 backdrop-blur-2xl overflow-y-auto"},ye={class:"flex flex-col items-center max-w-screen-md mx-auto p-2"},xe={key:0,class:"mt-20 text-center text-neutral-500 dark:text-neutral-400"},ke={__name:"List",props:{options:{type:Array,default:[]},editable:{type:Boolean,default:!0},titleProperty:{type:String,default:"title"},subTitleProperty:{type:String,default:"subTitle"}},emits:["skipTo","edit","remove"],setup(s,{emit:T}){const t=T,o=a=>{t("skipTo",a)},n=(a,i)=>{t("edit",a,i)},r=(a,i)=>{t("remove",a,i)};return(a,i)=>(l(),c("div",be,[p("div",ye,[(l(!0),c(L,null,j(s.options,(d,f)=>(l(),R(ge,{titleProperty:s.titleProperty,subTitleProperty:s.subTitleProperty,key:d._id,editable:s.editable,"model-value":d,onSkip:o,onEdit:m=>n(m,f),onRemove:m=>r(m,f)},null,8,["titleProperty","subTitleProperty","editable","model-value","onEdit","onRemove"]))),128)),!s.options||s.options.length===0?(l(),c("div",xe," 暂无记录 ")):M("",!0)])]))}},_e={class:"flex-grow whitespace-nowrap text-ellipsis overflow-hidden"},we={key:0,class:"h-8 leading-8"},Te={key:1,class:"text-slate-500 min-w-40"},Pe={class:"flex flex-col"},Ce={class:"flex flex-row"},$e=p("label",{class:"text-right mr-2 p-2"},"标题",-1),Be={__name:"BookMark",props:{book:{type:Object,required:!0}},emits:["skip","delete"],setup(s,{emit:T}){const t=u(!1);let o=0;const n=s,r=u(n.book.title),a=T,i=u(!1),d=()=>{a("skip",n.book._id)},f=()=>{if(O())return!0;i.value=!0},m=()=>{if(O())return!0;i.value=!1},g=C=>{o=C.touches[0].clientX},x=C=>{if(!o)return!0;let b=C.changedTouches[0].clientX;if(Math.abs(o-b)<10)return o=0,!0;o>b?i.value=!0:o<b&&(i.value=!1),o=0},v=()=>{t.value=!0},P=()=>{t.value=!1,!(!r.value||r.value===n.book.title)&&ce({id:n.book._id,title:r.value}).then(()=>{n.book.title=r.value,r.value=""})},S=()=>{t.value=!1},D=()=>{H.confirm({title:"确认删除",content:"确认删除该内容？",onOk:()=>{de(n.book._id).then(()=>{a("delete",n.book._id),ve.success("删除成功!")})}})};return(C,b)=>(l(),c("div",{class:"flex flex-row w-full justify-between items-center h-12 leading-[3rem] border border-gray-300/20 bg-white/90 dark:bg-neutral-900 m-1 px-4 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:_(d,["stop"]),onMouseover:_(f,["stop"]),onMouseleave:_(m,["stop"]),onTouchstartPassive:g,onTouchendPassive:x},[p("span",_e,[h(w,{class:"text-blue-300 mr-2",name:"chat-smile-2-line"}),p("span",null,V(s.book.title),1)]),i.value?(l(),c("span",we,[p("button",{class:"px-1 lg:px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-500 hover:text-gray-700",onClick:_(v,["stop"])},[h(w,{name:"edit-2-fill"})]),p("button",{class:"px-1 lg:px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-500 hover:text-gray-700",onClick:_(D,["stop"])},[h(w,{name:"delete-bin-fill"})])])):(l(),c("span",Te,V(s.book.createTime),1)),h(G,{title:"编辑",visible:t.value,"onUpdate:visible":b[1]||(b[1]=$=>t.value=$),onConfirm:P,onCancel:S},{default:q(()=>[p("div",Pe,[p("div",Ce,[$e,B(p("input",{class:"flex-1 border p-2 rounded","onUpdate:modelValue":b[0]||(b[0]=$=>r.value=$)},null,512),[[ae,r.value]])])])]),_:1},8,["visible"])],32))}},Me={class:"w-full bg-white/40 dark:bg-neutral-700/40 backdrop-blur-2xl overflow-y-auto"},Se={class:"flex flex-col items-center max-w-screen-md mx-auto p-2"},Ie={key:0,class:"mt-20 text-center text-neutral-500 dark:text-neutral-400"},Ee={__name:"BookHistory",emits:["skipTo"],setup(s,{emit:T}){const t=u([]),o=T,n=a=>{o("skipTo",a)},r=a=>{t.value.splice(a,1)};return A(()=>{pe().then(a=>{t.value=a})}),(a,i)=>(l(),c("div",Me,[p("div",Se,[(l(!0),c(L,null,j(t.value,(d,f)=>(l(),R(Be,{key:d._id,book:d,onSkip:n,onDelete:m=>r(f)},null,8,["book","onDelete"]))),128)),!t.value||t.value.length===0?(l(),c("div",Ie," 暂无历史记录 ")):M("",!0)])]))}},Ve={class:"flex flex-col w-full h-screen"},Re={class:"p-2 text-gray-500"},Oe={class:"flex-1 flex-col w-full bg-slate-300/20 overflow-hidden"},at={__name:"Robot",setup(s){const T=se(),t=le();re();const o=u([]),n=u(!1),r=u("tongyi"),a=u("");u(!0);const i=u(""),d=u(!1),f=u(!1),m=u([]),g=u();let x=u(0);const v=u(),P=e=>{var I;o.value=o.value.concat([{role:"user",content:e}]);let k="",y=((I=v==null?void 0:v.value)==null?void 0:I.content)||"";Q({appId:t.query.appId,id:a.value,mode:r.value,question:e,prompt:y},E=>{k+=E,i.value=k},E=>{E&&(a.value=E),i.value="",o.value=o.value.concat([{role:"assistant",content:k}])})},S=()=>{b(),v.value=void 0},D=()=>{d.value=!d.value},C=()=>{f.value=!f.value},b=e=>{T.push({path:"/robot",query:{id:e,appId:t.query.appId}}),d.value=!1},$=()=>{g.value={name:"",content:""},x=-1},X=(e,k)=>{g.value=e,x=k},z=(e,k)=>{let y=e==null?void 0:e._id;y&&ee(y).then(I=>{I&&m.value.splice(k,1)})},N=()=>{x===-1?te(g.value).then(e=>{e&&(m.value.push(e),g.value=void 0,x=0)}):oe(g.value).then(e=>{e&&(m.value.splice(x,1,e),g.value=void 0,x=0)})},F=()=>{g.value=void 0},K=e=>{v.value=e,f.value=!1},U=()=>{v.value=void 0};return ne(()=>t.query.id,(e,k)=>{e!==k&&(a.value=e,e?me(e).then(y=>{o.value=JSON.parse(y.content||"[]")}):o.value=[])},{immediate:!0}),A(()=>{Y().then(e=>{e&&e.length>0&&(m.value=e||[])})}),(e,k)=>{const y=ie("tippy");return l(),c("div",Ve,[h(J,{hiddenFold:!0},{default:q(()=>[p("div",Re,[B((l(),c("button",{class:"hover:bg-gray-200 hover:text-gray-700 px-1 rounded mr-2",onClick:S},[h(w,{class:"text-xl",name:"chat-new-line"})])),[[y,{content:"新对话"}]]),B((l(),c("button",{class:ue(["hover:bg-gray-200 hover:text-gray-700 px-1 rounded mr-2",{"text-gray-700":d.value,"bg-gray-200":d.value}]),onClick:D},[h(w,{class:"text-xl",name:"chat-history-line"})],2)),[[y,{content:"历史对话"}]]),B((l(),c("button",{class:"hover:bg-gray-200 hover:text-gray-700 px-1 rounded mr-2",onClick:C},[h(w,{class:"text-xl",name:"robot-line"})])),[[y,{content:"提词管理"}]]),B((l(),c("button",{class:"relative hover:bg-gray-200 hover:text-gray-700 px-1 rounded",onClick:$},[h(w,{class:"text-xl",name:"robot-3-line"})])),[[y,{content:"创建提词"}]])])]),_:1}),p("div",Oe,[h(W,{showCharter:"",chatter:v.value,cardOperation:!0,editable:!0,messages:o.value,loading:n.value,onChart:P,response:i.value,onClearChatter:U,owner:e.userId},null,8,["chatter","messages","loading","response","owner"])]),d.value?(l(),R(Ee,{key:0,class:"fixed top-16 bottom-0 right-0 z-50",onSkipTo:b})):M("",!0),f.value?(l(),R(ke,{key:1,class:"fixed top-16 bottom-0 right-0 z-50",options:m.value,titleProperty:"name",onEdit:X,onRemove:z,onSkipTo:K},null,8,["options"])):M("",!0),h(Z,{visible:!!g.value,prompt:g.value,onConfirm:N,onCancel:F},null,8,["visible","prompt"])])}}};export{at as default};
