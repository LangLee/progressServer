const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Markdown-DfbZZKpM.js","./tiptap-Bkjnv3GL.js","./vendor-DqHIQWU1.js","../css/vendor-C0fGup_u.css","./index-bEem1MK9.js","../css/index-D2BWJ-bb.css","./message-DsTL7g5X.js","../css/message-Ld0-QEl8.css","./file-D7E9LNHg.js","./utils-DVDKZiQc.js","./remixicon-l0sNRNKZ.js","./ImageView-B5jy2EQC.js","./ai-BzmOfZ_l.js","./FloatMenu-C_FOx9on.js","../css/FloatMenu-CrYkVplT.css","./PromptModal-CoDoiaRN.js","./ProInput-DLzwbHQE.js","../css/ProInput-C8YhN2zD.css","../css/PromptModal-OHlHABdJ.css","./operation-BrucOqqW.js","../css/Markdown-DmGk779c.css","./Chat-ejwL1FZd.js","./ChatPanel-DWOakeds.js","./no-data-ou6-36FL.js","./Header-jlxeZXVD.js","./userInfo-CSbayTML.js","./user-BZG51SbY.js","./Question-DbNPOHdm.js","../css/Question-DN7bJTeH.css","./oneNote-D4VVWFj3.js","../css/Loading-B01z9qu9.css","./Text-i8W9Dru3.js","./Task-D6cFe1mh.js","../css/Task-CoyDmG1V.css","./Drawing-CJ0ayrPg.js","../css/Drawing-Bdgq6z4a.css"])))=>i.map(i=>d[i]);
import{b as $,a as p,c as T}from"./index-bEem1MK9.js";import{aG as O,as as y,b5 as d,b6 as R,ai as P,aL as N,ao as D,aj as k,aW as M,ap as W,aC as V,az as L,aA as j,a_ as H,b7 as U,aB as K,b8 as q,b9 as _,aR as f}from"./vendor-DqHIQWU1.js";import{g as F,u as C}from"./book-J-0CnIOg.js";import{m as h}from"./message-DsTL7g5X.js";import{L as J}from"./Loading-DYsgb3I1.js";import{c as G}from"./utils-DVDKZiQc.js";import{B as Q,S as X,I as Y,C as Z,L as ee,P as te,a as re,b as ae,H as oe,O as ne,c as se,d as le,e as ie}from"./tiptap-Bkjnv3GL.js";/* empty css                                                                */import"./remixicon-l0sNRNKZ.js";let w=0,m;const ce=()=>{if(w++,m)return;const e=O(J);m=document.createElement("div"),m.className="fixed top-0 left-0 bottom-0 w-full z-50",y(e,m),document.body.appendChild(m)},ue=()=>{w--,w===0&&m&&(y(null,m),m.remove(),m=void 0)},g={show:ce,hide:ue},me=new WeakMap;function de(e){return me.has(e)}function pe(e,t,o,s){const l=de(o)?"<br>":`\\
`;for(let c=s+1;c<o.childCount;c+=1)if(o.child(c).type!==t.type){e.write(l);return}}function fe(e,t){const{parens:o}=t.attrs,s=t.attrs.start||1,l=String(s+t.childCount-1).length,c=e.repeat(" ",l+2),u=o?")":".";e.renderList(t,c,v=>{const b=String(s+v);return`${e.repeat(" ",l-b.length)+b}${u} `})}function B(e,t,o,s){if(e.attrs.title||!/^\w+:/.test(e.attrs.href))return!1;const l=t.child(o+(s<0?-1:0));if(!l.isText||l.text!==e.attrs.href||l.marks[l.marks.length-1]!==e)return!1;if(o===(s<0?1:t.childCount-1))return!0;const c=t.child(o+(s<0?-2:1));return!e.isInSet(c.marks)}const he={...d.marks,[Q.name]:d.marks.strong,[X.name]:{open:"~~",close:"~~",mixable:!0,expelEnclosingWhitespace:!0},[Y.name]:{open:"_",close:"_",mixable:!0,expelEnclosingWhitespace:!0},[Z.name]:d.marks.code,[ee.name]:{open(e,t,o,s){return console.log(e),B(t,o,s,1)?"<":"["},close(e,t,o,s){const l=t.attrs.canonicalSrc||t.attrs.href;return B(t,o,s,-1)?">":`](${e.esc(l)}${t.attrs.title?` ${e.quote(t.attrs.title)}`:""})`}}},ve={...d.nodes,[te.name]:d.nodes.paragraph,[re.name]:d.nodes.bullet_list,[ae.name]:d.nodes.list_item,[oe.name]:d.nodes.horizontal_rule,[ne.name]:fe,[se.name]:pe,[le.name]:(e,t)=>{e.write(`\`\`\`${t.attrs.language||""}
`),e.text(t.textContent,!1),e.ensureNewLine(),e.write("```"),e.closeBlock(t)},[ie.name]:(e,t)=>{t.attrs.multiline?(e.write(">>>"),e.ensureNewLine(),e.renderContent(t),e.ensureNewLine(),e.write(">>>"),e.closeBlock(t)):e.wrapBlock("> ",null,t,()=>e.renderContent(t))}},be=e=>new R(ve,he).serialize(e,{tightLists:!0}),_e={serialize:be},Se=P({__name:"Book",setup(e){const t=N(),o=D(),s=k(""),l=k(Array()),c=k(!1);let u,v="";const b=()=>new Promise(a=>{if(s.value===v)return a(!0);let i=[];l.value.length>0&&(i=l.value.map(n=>({id:n.id,itemIndex:n.itemIndex,level:n.level,originalLevel:n.originalLevel,pos:n.pos,textContent:n.textContent})));let r={id:u._id,content:s.value,anchors:i};C(r).then(n=>{n&&(v=s.value,h.success("保存成功"),a(!0))}).catch(n=>{h.error(n),a(!1)})}),x=()=>{b().then(()=>{T(!1)})},E=()=>{let a={id:u._id,share:!0};C(a).then(()=>{const i=`${$}/#/book/${a.id}`,r=`标题：${a.title}
链接：${i}
`;G(r,()=>{h.success("已经复制到剪切板！")})})},S=(a,i)=>{switch(a){case"json":{let r=i.getJSON();const n=new Blob([JSON.stringify(r)],{type:"application/json;charset=utf-8"});_.saveAs(n,`${u.title}.json`);break}case"html":{let r=i.getHTML();const n=new Blob([r],{type:"text/html;charset=utf-8"});_.saveAs(n,`${u.title}.html`);break}case"docx":{h.warning("暂不支持导出word格式, 敬请期待！");break}case"markdown":{let r=_e.serialize(i.view.state.doc);const n=new Blob([r],{type:"text/markdown;charset=utf-8"});_.saveAs(n,`${u.title}.md`);break}case"pdf":{h.warning("暂不支持导出pdf格式, 敬请期待！");break}case"image":{const r=document.getElementById("editorWrapper");if(r){let n=document.createElement("p");n.className="editor-footer",n.innerText="http://progress123.online",r.appendChild(n),q(r,{useCORS:!0,allowTaint:!1}).then(function(z){z.toBlob(A=>{_.saveAs(A,`${u.title}.png`),r.removeChild(n)})})}break}}},I=a=>{switch(a){case"markdown":{o.value=f(()=>p(()=>import("./Markdown-DfbZZKpM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url));break}case"chat":o.value=f(()=>p(()=>import("./Chat-ejwL1FZd.js"),__vite__mapDeps([21,22,23,10,24,2,3,4,5,25,8,26,9,6,7,27,28,29,30]),import.meta.url));break;case"text":{o.value=f(()=>p(()=>import("./Text-i8W9Dru3.js"),__vite__mapDeps([31,1,2,3,9,10,13,4,5,6,7,14,19]),import.meta.url));break}case"task":{o.value=f(()=>p(()=>import("./Task-D6cFe1mh.js"),__vite__mapDeps([32,1,2,3,13,4,5,6,7,14,9,10,33]),import.meta.url));break}case"drawing":{o.value=f(()=>p(()=>import("./Drawing-CJ0ayrPg.js"),__vite__mapDeps([34,1,2,3,6,7,9,10,13,4,5,14,35]),import.meta.url));break}default:{o.value=f(()=>p(()=>import("./Markdown-DfbZZKpM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url));break}}};return M(()=>t.params.id,(a,i)=>{a&&a!==i&&(a=typeof a=="string"?a:"",g.show(),F(a).then(r=>{s.value=r.content||"",l.value=r.anchors||[],v=r.content||"",c.value=r.editable&&r.type!=="chat"||!1,I(r.type),u=r,g.hide()}).catch(r=>{h.error(r),g.hide()}))},{immediate:!0}),W(()=>{document.addEventListener("keydown",a=>{console.log("press key",a.ctrlKey,a.key),(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),x())})}),V(()=>{}),(a,i)=>(L(),j("div",{class:K(["w-full h-full flex max-w-screen-2xl mx-auto",{"select-none":!c.value}])},[(L(),H(U(o.value),{editable:c.value,modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=r=>s.value=r),anchors:l.value,"onUpdate:anchors":i[1]||(i[1]=r=>l.value=r),onSave:x,onShare:E,onExport:S},null,40,["editable","modelValue","anchors"]))],2))}});export{Se as default};
