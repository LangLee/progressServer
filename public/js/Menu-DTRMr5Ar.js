import{az as pe,aA as me,aj as h,ao as he,aT as G,aD as o,aE as s,aH as v,aF as r,aX as u,aR as T,aG as z,aV as X,a$ as j,aY as A,aw as ge,aO as H,aP as L,aW as O,aS as W,aU as Y,b0 as J,b1 as ye,b2 as be}from"./vendor-CWXOCgin.js";import{c as xe,u as Q,r as ke}from"./book-PI_kZs2c.js";import{g as _e,B as Te,G as Ce,c as we,u as $e,r as Be}from"./GroupModal-HttnGsel.js";import{m as C}from"./message-B11-HW_C.js";import{R as g}from"./RemixIcon-CgHXNHMg.js";import{i as Z,c as Ie}from"./utils-BIo_BOvM.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee=f=>(ye("data-v-f75df523"),f=f(),be(),f),Ge={key:0,class:"flex lg:mx-4 py-2 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60 font-sans-serif font-medium"},Ee=ee(()=>v("span",null,"分类",-1)),Se=ee(()=>v("span",null,"笔记",-1)),Ve={key:1,class:"flex-1 px-1 sm:px-3 xl:px-5 pb-10 lg:pb-14 bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},Pe=["onUpdate:modelValue","onKeyup"],De=["onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],Re={class:"mr-2"},Ue={key:0,class:"absolute right-2 top-0 font-sans text-slate-50"},Fe=["onClick"],Ke=["onClick"],Ne={class:"ml-2 px-2 border-l border-gray-200 dark:border-gray-500"},qe=["id"],ze=["onUpdate:modelValue","onKeyup"],Xe=["onClick","onDblclick","onMouseover","onMouseleave","onTouchstartPassive","onTouchendPassive"],je={key:0,class:"absolute right-2 top-0 font-sans text-slate-50"},Ae=["onClick"],He=["onClick"],Le=["onClick"],Oe={key:2,class:"h-full flex flex-col justify-center text-center text-gray-500 text-sm bg-white/95 lg:bg-transparent dark:bg-neutral-900/60"},We={class:"mt-1 italic"},Ye={__name:"Menu",props:{fold:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},fixedType:{type:String,default:""},defaultGroup:{type:Boolean,default:!1},defaultSelected:{type:Boolean,default:!0}},emits:["toggleFold","menuChange"],setup(f,{emit:te}){pe();const b=me(),l=h([]),ae=h(b.query.appId),B=h(""),x=h(""),d=h(""),p=h(void 0),c=h(void 0),m=h(!1);let k=null;const{proxy:_}=ge(),w=f,I=h(!0),E=te,ne=e=>{switch(e){case"markdown":return"markdown-line";case"text":return"draft-line";case"chat":return"message-2-line";case"link":return"links-line";case"todo":return"todo-line";case"drawing":return"image-edit-line";case"code":return"file-code-line";default:return"markdown-line"}},M=()=>{I.value=!0,E("toggleFold",!0)},$=e=>{let{id:t}=e||{};B.value=t||"",d.value="",M(),E("menuChange",t,b.query.appId)},S=()=>{p.value={name:"新增分类"},m.value=!0},le=e=>{e!=="default"&&(d.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;console.log(t),t&&t[0]&&t[0].focus()}))},oe=e=>{p.value=e,m.value=!1},se=()=>{p.value&&m.value?we(p.value).then(e=>{let{_id:t,name:a}=e;t&&(l.value.push({id:t,name:a,books:[]}),d.value="",p.value=void 0,m.value=!1)}):p.value&&V(p.value)},V=e=>{$e(e).then(()=>{d.value="",p.value=void 0,m.value=!1})},ie=(e,t)=>{if(e.books&&e.books.length>0){C.warning("该分类下有书籍，不能删除!");return}Be(e.id).then(()=>{C.success("删除分类成功!"),l.value.splice(t,1)})},re=()=>{var e;m.value=!0,c.value={title:"新增笔记",type:w.fixedType||"markdown",category:(e=l==null?void 0:l.value[0])==null?void 0:e.id}},ue=()=>{c&&m.value?xe(c.value).then(e=>{let t=l.value.find(({id:a})=>a===e.category);!t&&(t=l.value.find(({id:a})=>a==="default"),!t)||(t.books=t.books||[],e.id=e._id,t.books.splice(0,0,e),$(e),c.value=void 0)}):c&&c.value&&D(c.value)},P=()=>{d.value="",c.value=void 0,p.value=void 0,m.value=!1},de=(e,t)=>{let a=e[t];!a||!a.id||ke(a.id).then(()=>{e.splice(t,1);let y=e&&e.length>t?t:e.length-1;$(y<0?null:e[y]),C.success("删除书籍成功!")})},ce=e=>{d.value=e,_.$nextTick(()=>{let t=_.$refs.titleInput;t&&t[0]&&t[0].focus()})},ve=e=>{d.value=e.category,c.value=e,m.value=!1},D=e=>{Q({...e,category:e.category==="default"?"":e.category}).then(t=>{d.value,e.category,d.value="",c.value=void 0})};he(()=>{_e(w.defaultGroup).then(e=>{l.value=e||[],w.defaultSelected&&!b.params.id&&l.value[0]&&l.value[0].books&&l.value[0].books[0]&&$(l.value[0].books[0]),b.params.id&&_.$nextTick(()=>{R(b.params.id||l.value[0].books[0].id)})})});const R=e=>{let t=document.getElementById("sideBar");if(t&&e){let a=document.getElementById(`book-${e}`);a&&t.scrollTo({top:a.offsetTop,behavior:"smooth"})}},U=e=>{if(Z())return!1;x.value=e},F=e=>{if(Z())return!1;x.value=""},K=(e,t)=>{k={x:e.touches[0].clientX,target:t}},N=(e,t)=>{if(!k)return!0;let{x:a,target:y}=k;if(y!==t)return k=null,!0;let n=e.changedTouches[0].clientX;if(Math.abs(a-n)<10)return k=null,!0;a>n?x.value=t:a<n&&(x.value=""),k=null},fe=e=>{e.share=!e.share,Q(e).then(t=>{if(e.share){const a=`${window.location.origin}/#/book/${e.id}`,y=`标题：${e.title}
链接：${a}
`;Ie(y),C.success("已经复制到剪切板！")}else C.success("取消分享成功！")})};return G(()=>b.params.id,(e,t)=>{e!==t&&(B.value=e,d.value="",M(),_.$nextTick(()=>{R(e)}))},{immediate:!0}),G(()=>b.query.appId,e=>{ae.value=e,console.log(e)},{immediate:!0}),G(()=>w.fold,(e,t)=>{I.value=e},{immediate:!0}),(e,t)=>(o(),s("div",{id:"sideBar",class:A(["flex flex-col fixed top-16 bottom-0 backdrop-blur overflow-y-auto z-50 bg-black/20 dark:bg-transparent lg:bg-transparent w-full lg:w-80 pr-24 lg:pr-0 transition-transform duration-300 ease-out delay-100 lg:translate-x-0",I.value?"translate-x-[-100%]":"translate-x-0"]),onClick:u(M,["stop"])},[f.editable&&l.value&&l.value.length>0?(o(),s("div",Ge,[v("button",{class:"h-8 leading-8 text-blue-500 hover:text-blue-700 mx-2",onClick:u(S,["stop"])},[r(g,{class:"mr-1",name:"folder-add-line"}),Ee]),v("button",{class:"h-8 leading-8 text-blue-500 hover:text-blue-700 mx-2",onClick:u(re,["stop"])},[r(g,{class:"mr-1",name:"sticky-note-add-line"}),Se])])):T("",!0),l.value&&l.value.length>0?(o(),s("nav",Ve,[v("ul",null,[(o(!0),s(z,null,X(l.value,(a,y)=>(o(),s("li",{key:a.id},[a.id===d.value?H((o(),s("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":n=>a.name=n,onKeyup:O(n=>V(a),["enter"])},null,40,Pe)),[[L,a.name]]):(o(),s("div",{key:1,class:"px-1 h-10 leading-10 relative font-medium text-gray-700 dark:text-gray-300 cursor-pointer",onDblclick:u(n=>le(a.id),["stop"]),onMouseover:u(n=>U(a.id),["stop"]),onMouseleave:u(n=>F(a.id),["stop"]),onTouchstartPassive:n=>K(n,a.id),onTouchendPassive:n=>N(n,a.id)},[v("span",Re,W(a.name),1),r(J,{name:"slide"},{default:Y(()=>[x.value===a.id?(o(),s("div",Ue,[f.editable&&!a.readonly?(o(),s("span",{key:0,class:"rounded cursor-pointer bg-blue-300 hover:bg-blue-700 mr-1",onClick:u(n=>oe(a),["stop"])},[r(g,{name:"edit-line"})],8,Fe)):T("",!0),f.editable&&!a.readonly&&(!a.books||a.books.length<=0)?(o(),s("span",{key:1,class:"rounded cursor-pointer bg-red-300 hover:bg-red-700",onClick:u(n=>ie(a,y),["stop"])},[r(g,{name:"delete-bin-line"})],8,Ke)):T("",!0)])):T("",!0)]),_:2},1024)],40,De)),v("ul",Ne,[(o(!0),s(z,null,X(a.books,(n,q)=>(o(),s("li",{class:"mb-1",id:`book-${n.id}`,key:n.id},[n.id===d.value?H((o(),s("input",{key:0,ref_for:!0,ref:"titleInput",class:"p-2 w-full rounded-md",type:"text","onUpdate:modelValue":i=>n.title=i,onKeyup:O(i=>D(n),["enter"])},null,40,ze)),[[L,n.title]]):(o(),s("a",{key:1,onClick:u(i=>$(n),["stop"]),onDblclick:u(i=>ce(n.id),["stop"]),onMouseover:i=>U(n.id),onMouseleave:i=>F(n.id),onTouchstartPassive:i=>K(i,n.id),onTouchendPassive:i=>N(i,n.id),class:"h-8 leading-8 block px-2 rounded-md transition-colors duration-200 relative text-gray-500 hover:text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"},[v("span",{class:A(["relative w-full inline-block text-ellipsis whitespace-nowrap overflow-hidden",n.id===B.value?"text-blue-500 font-bold":""])},[r(g,{class:"text-blue-500",name:ne(n.type)},null,8,["name"]),j(" "+W(n.title),1)],2),r(J,{name:"slide"},{default:Y(()=>[f.editable&&x.value===n.id?(o(),s("div",je,[v("span",{class:"rounded cursor-pointer bg-slate-300 hover:bg-slate-500 mr-1",onClick:u(i=>fe(n),["stop"])},[r(g,{name:n.share?"eye-off-line":"share-line"},null,8,["name"])],8,Ae),v("span",{class:"rounded cursor-pointer bg-blue-300 hover:bg-blue-500 mr-1",onClick:u(i=>ve(n),["stop"])},[r(g,{name:"edit-line"})],8,He),v("span",{class:"rounded cursor-pointer bg-red-300 hover:bg-red-500",onClick:u(i=>de(a.books,q),["stop"])},[r(g,{name:"delete-bin-line"})],8,Le)])):T("",!0)]),_:2},1024)],40,Xe))],8,qe))),128))])]))),128))])])):(o(),s("div",Oe,[r(g,{name:"folder-6-line",class:"text-2xl"}),v("p",We,[j("暂无数据"),f.editable?(o(),s("a",{key:0,src:"#",class:"text-blue-500 mt-2 underline cursor-pointer hover:text-blue-700",onClick:S},"创建")):T("",!0)])])),r(Te,{fixedType:f.fixedType,title:`${m.value?"新增":"编辑"}书籍`,visible:!!c.value,onConfirm:ue,onCancel:P,book:c.value,categories:l.value},null,8,["fixedType","title","visible","book","categories"]),r(Ce,{title:`${m.value?"新增分类":"编辑分类"}`,visible:!!p.value,group:p.value,onConfirm:se,onCancel:P},null,8,["title","visible","group"])],2))}},lt=Me(Ye,[["__scopeId","data-v-f75df523"]]);export{lt as M};
